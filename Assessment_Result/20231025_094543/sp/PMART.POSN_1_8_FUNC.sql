REPLACE PROCEDURE PMART.POSN_1_8_FUNC
(
X_ID         VARCHAR(400), 
FP_PRD_TYPE  VARCHAR(400), 
FP_PRD_ID    VARCHAR(400), 
FP_TIME_LIST VARCHAR(400), 
FP_ORG_LEVEL NUMBER,       
FP_ORG_LIST  VARCHAR(400), 
FP_MMA_LEVEL NUMBER,       
FP_MMA_ID    VARCHAR(400), 
FP_AMT_TYPE  VARCHAR(400)  
)            
SQL SECURITY INVOKER
SP:BEGIN
   DECLARE SQLSTR     VARCHAR(4000);
   CALL PMART.P_DROP_TABLE ('#VT_POSN_1_8_FUNC'); 
   CALL PMART.POSN_MFACT_FUNC('D',FP_TIME_LIST,'PRD',FP_PRD_ID,0,FP_ORG_LEVEL,FP_ORG_LIST,FP_MMA_LEVEL,FP_MMA_ID,FP_PRD_TYPE,FP_AMT_TYPE);
   CALL PMART.POSN_SFACT_FUNC('D',FP_TIME_LIST,FP_ORG_LEVEL,FP_ORG_LIST,FP_MMA_LEVEL,FP_MMA_ID);
   SET SQLSTR ='CREATE MULTISET VOLATILE TABLE #VT_POSN_1_8_FUNC  AS('+
    'SELECT '+X_ID+' AS X_ID,'+      
    'A.PRD_ID, '+                      
    'SUM(A.REAL_SALES_AMT) AS REALSALES_AMT, '+  
    'SUM(A.SALES_CNT) AS SALES_CNT , '+          
    'B.STNUM_STORE_NUM AS PSD '+                        
    'FROM #VT_POSN_MFACT_FUNC A  '+
    ',(SELECT ORG_ID, SUM(STNUM_STORE_NUM) AS STNUM_STORE_NUM FROM #VT_POSN_SFACT_FUNC GROUP BY ORG_ID )B  '+
    'WHERE A.ORG_ID = B.ORG_ID '+
    'GROUP BY A.PRD_ID, B.STNUM_STORE_NUM '+
    ') WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;';
  EXECUTE IMMEDIATE SQLSTR;
END SP;