REPLACE PROCEDURE PMART.FUNC_FACT_OPENYEAR_DIM
(
   IN P_SHOWTYPE INTEGER,  
   IN P_OPENYEAR SMALLINT
)
SP:BEGIN
    DECLARE SQLSTR  VARCHAR(2000) ;
    CALL PMART.P_DROP_TABLE ('#VT_FUNC_FACT_OPENYEAR_DIM');
    SET SQLSTR = 'CREATE MULTISET VOLATILE TABLE #VT_FUNC_FACT_OPENYEAR_DIM ( '
						 +'YEAR_ID SMALLINT, '
	                     +'YEAR_NAME VARCHAR(20)   '
	                     +') UNIQUE PRIMARY INDEX(YEAR_ID) ON COMMIT PRESERVE ROWS; ';
    EXECUTE IMMEDIATE SQLSTR;   
    IF P_SHOWTYPE = 2 THEN 
		SET SQLSTR = 'INSERT INTO #VT_FUNC_FACT_OPENYEAR_DIM(YEAR_ID,YEAR_NAME) VALUES(-1,CAST(''' +'合計' +'''  AS VARCHAR(20))); ';
	ELSE
	    SET SQLSTR = 'INSERT INTO #VT_FUNC_FACT_OPENYEAR_DIM(YEAR_ID,YEAR_NAME) VALUES(-1,CAST(''' +'
    END IF;	
	EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR =' INSERT INTO  #VT_FUNC_FACT_OPENYEAR_DIM '
	                     +' SELECT DISTINCT YEAR_ID, YEAR_ID AS YEAR_NAME  FROM ( '
                         +'  SELECT CAST(TO_CHAR(P.OPEN_DATE,''YYYY'') AS INTEGER) - 1911 AS YEAR_ID '
                         +'     FROM PMART.LAST_ORG_STORE OST  '
						 +'                INNER  JOIN PDATA.PBMSTOR P ON OST.OSTORE_ID = CAST(P.STORE_NO AS INTEGER)  '
						 +'  WHERE OST.CLOSE_DATE = CAST(''9999-12-31'' AS DATE)  '
						 +'   ) DAT';
	IF P_OPENYEAR > 0 THEN 
	    SET SQLSTR = SQLSTR + ' WHERE DAT.YEAR_ID = ' + P_OPENYEAR;
	END IF;
    EXECUTE IMMEDIATE SQLSTR;   
END SP;