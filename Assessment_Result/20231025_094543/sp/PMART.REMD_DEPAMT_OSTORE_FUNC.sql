REPLACE PROCEDURE PMART.REMD_DEPAMT_OSTORE_FUNC
(P_L_YEAR_ID NUMBER,P_OSTORE_ID NUMBER)
SQL SECURITY INVOKER
SP:BEGIN
   DECLARE SQLSTR  VARCHAR(4000); 	
   DECLARE V_TABLE_NAME VARCHAR(30);
   DECLARE V_L_MONTH_ID NUMBER;
   CALL PMART.P_DROP_TABLE ('#VT_REMD_DEPAMT_OSTORE_FUNC'); 
   SET SQLSTR ='CREATE MULTISET VOLATILE TABLE #VT_REMD_DEPAMT_OSTORE_FUNC  AS('+
                   'SELECT '+
                   '-1 AS TOT_ID, '+
                   'B.L_MONTH_ID AS L_MONTH_ID, '+
                   'CAST(A.TOT_DEPAMT1  AS DECIMAL(16,6))/DECODE(A.TOT_PLAN_STNUM,0,NULL,A.TOT_PLAN_STNUM) AS DD1, '+
                   'CAST(A.TOT_DEPAMT2  AS DECIMAL(16,6))/DECODE(A.TOT_PLAN_STNUM,0,NULL,A.TOT_PLAN_STNUM) AS DD2, '+
                   'CAST(A.TOT_DEPAMT3  AS DECIMAL(16,6))/DECODE(A.TOT_PLAN_STNUM,0,NULL,A.TOT_PLAN_STNUM) AS DD3, '+
                   'CAST(A.TOT_DEPAMT4  AS DECIMAL(16,6))/DECODE(A.TOT_PLAN_STNUM,0,NULL,A.TOT_PLAN_STNUM) AS DD4, '+
                   'CAST(A.TOT_DEPAMT5  AS DECIMAL(16,6))/DECODE(A.TOT_PLAN_STNUM,0,NULL,A.TOT_PLAN_STNUM) AS DD5, '+
                   'CAST(A.TOT_DEPAMT6  AS DECIMAL(16,6))/DECODE(A.TOT_PLAN_STNUM,0,NULL,A.TOT_PLAN_STNUM) AS DD6, '+
                   'CAST(A.TOT_DEPAMT7  AS DECIMAL(16,6))/DECODE(A.TOT_PLAN_STNUM,0,NULL,A.TOT_PLAN_STNUM) AS DD7, '+
                   'CAST(A.TOT_DEPAMT8  AS DECIMAL(16,6))/DECODE(A.TOT_PLAN_STNUM,0,NULL,A.TOT_PLAN_STNUM) AS DD8, '+
                   'CAST(A.TOT_DEPAMT9  AS DECIMAL(16,6))/DECODE(A.TOT_PLAN_STNUM,0,NULL,A.TOT_PLAN_STNUM) AS DD9, '+
                   'CAST(A.TOT_DEPAMT10 AS DECIMAL(16,6))/DECODE(A.TOT_PLAN_STNUM,0,NULL,A.TOT_PLAN_STNUM) AS DD10, '+
                   'CAST(A.TOT_DEPAMT11 AS DECIMAL(16,6))/DECODE(A.TOT_PLAN_STNUM,0,NULL,A.TOT_PLAN_STNUM) AS DD11, '+
                   'CAST(A.TOT_DEPAMT12 AS DECIMAL(16,6))/DECODE(A.TOT_PLAN_STNUM,0,NULL,A.TOT_PLAN_STNUM) AS DD12, '+
                   'CAST(A.TOT_DEPAMT13 AS DECIMAL(16,6))/DECODE(A.TOT_PLAN_STNUM,0,NULL,A.TOT_PLAN_STNUM) AS DD13, '+
                   'CAST(A.TOT_DEPAMT14 AS DECIMAL(16,6))/DECODE(A.TOT_PLAN_STNUM,0,NULL,A.TOT_PLAN_STNUM) AS DD14, '+
                   'CAST(A.TOT_DEPAMT1  AS DECIMAL(16,6))/DECODE(A.TOT_AMT,0,NULL,A.TOT_AMT)*100 AS DR1, '+
                   'CAST(A.TOT_DEPAMT2  AS DECIMAL(16,6))/DECODE(A.TOT_AMT,0,NULL,A.TOT_AMT)*100 AS DR2, '+
                   'CAST(A.TOT_DEPAMT3  AS DECIMAL(16,6))/DECODE(A.TOT_AMT,0,NULL,A.TOT_AMT)*100 AS DR3, '+
                   'CAST(A.TOT_DEPAMT4  AS DECIMAL(16,6))/DECODE(A.TOT_AMT,0,NULL,A.TOT_AMT)*100 AS DR4, '+
                   'CAST(A.TOT_DEPAMT5  AS DECIMAL(16,6))/DECODE(A.TOT_AMT,0,NULL,A.TOT_AMT)*100 AS DR5, '+
                   'CAST(A.TOT_DEPAMT6  AS DECIMAL(16,6))/DECODE(A.TOT_AMT,0,NULL,A.TOT_AMT)*100 AS DR6, '+
                   'CAST(A.TOT_DEPAMT7  AS DECIMAL(16,6))/DECODE(A.TOT_AMT,0,NULL,A.TOT_AMT)*100 AS DR7, '+
                   'CAST(A.TOT_DEPAMT8  AS DECIMAL(16,6))/DECODE(A.TOT_AMT,0,NULL,A.TOT_AMT)*100 AS DR8, '+
                   'CAST(A.TOT_DEPAMT9  AS DECIMAL(16,6))/DECODE(A.TOT_AMT,0,NULL,A.TOT_AMT)*100 AS DR9, '+
                   'CAST(A.TOT_DEPAMT10 AS DECIMAL(16,6))/DECODE(A.TOT_AMT,0,NULL,A.TOT_AMT)*100 AS DR10, '+
                   'CAST(A.TOT_DEPAMT11 AS DECIMAL(16,6))/DECODE(A.TOT_AMT,0,NULL,A.TOT_AMT)*100 AS DR11, '+
                   'CAST(A.TOT_DEPAMT12 AS DECIMAL(16,6))/DECODE(A.TOT_AMT,0,NULL,A.TOT_AMT)*100 AS DR12, '+
                   'CAST(A.TOT_DEPAMT13 AS DECIMAL(16,6))/DECODE(A.TOT_AMT,0,NULL,A.TOT_AMT)*100 AS DR13, '+
                   'CAST(A.TOT_DEPAMT14 AS DECIMAL(16,6))/DECODE(A.TOT_AMT,0,NULL,A.TOT_AMT)*100 AS DR14 '+
                   'FROM PMART.REMD_FACT_DEPAMT A, '+
                   '(SELECT '+
                   'DISTINCT L_MONTH_ID,L_MONTH_NAME FROM PMART.YMWD_TIME '+
                   ' WHERE L_YEAR_ID='+P_L_YEAR_ID+') B '+
                   'WHERE A.L_MONTH_ID=B.L_MONTH_ID '+
                   'AND A.OSTORE_ID='+P_OSTORE_ID+' '
               ') WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;';      
	EXECUTE IMMEDIATE SQLSTR;
END SP;