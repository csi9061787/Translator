REPLACE PROCEDURE PMART.SHOP_ST_NUM_FUNC2 
(I_TIME_ID1 NUMBER, I_TIME_ID2 NUMBER, I_ORG_ID NUMBER)
SQL SECURITY INVOKER
SP:BEGIN
DECLARE SQLSTR  VARCHAR(4000); 
DECLARE V_ORG_ID NUMBER;
  CALL PMART.P_DROP_TABLE ('#VT_SHOP_ST_NUM_FUNC2');
  IF I_ORG_ID IS NULL THEN 
     SET V_ORG_ID = -1;
  ELSE
     SET V_ORG_ID = I_ORG_ID;
  END IF;
  CALL PMART.SHOP_ST_NUM_FUNC(I_TIME_ID1, I_TIME_ID2, V_ORG_ID);
     IF (I_TIME_ID1<>0 AND I_TIME_ID2<>0) THEN
         SET SQLSTR = 
             'CREATE MULTISET VOLATILE TABLE #VT_SHOP_ST_NUM_FUNC2 AS('+      
                 'SELECT TIME_ID, MMA_ID, MMA_NM, TO_CHAR(STORE_NUM) AS STORE_NUM '+
                  'FROM #VT_SHOP_ST_NUM_FUNC  '+
             ') WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;';
        EXECUTE IMMEDIATE SQLSTR;  
    ELSE
         SET SQLSTR = 
             'CREATE MULTISET VOLATILE TABLE #VT_SHOP_ST_NUM_FUNC2 AS('+   
                  'SELECT DISTINCT NULL AS TIME_ID, MMA_ID, PARENT_NAME AS MMA_NM,''
                  'FROM PMART.MSTV_SHOP_LIST '+
             ') WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;';
        EXECUTE IMMEDIATE SQLSTR;                   
    END IF;
END SP;