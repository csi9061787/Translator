REPLACE PROCEDURE PMART.OT_TCFACT_FUNC(
FP_TIME_ID INTEGER,
FP_ORG_LEVEL INTEGER,FP_ORG_LIST VARCHAR(2000),
FP_PRD_LEVEL INTEGER,FP_PRD_ID VARCHAR(7))
SQL SECURITY INVOKER
SP:BEGIN
DECLARE SQLSTR  VARCHAR(4000);
DECLARE V_TABLE_NAME VARCHAR(30);
DECLARE V_ORG_ID   NUMBER;
DECLARE V_CNT_TR00  NUMBER;
DECLARE V_CNT_TR01  NUMBER;
DECLARE V_CNT_TR02  NUMBER;
DECLARE V_CNT_TR03  NUMBER;
DECLARE V_CNT_TR04  NUMBER;
DECLARE V_CNT_TR05  NUMBER;
DECLARE V_CNT_TR06  NUMBER;
DECLARE V_CNT_TR07  NUMBER;
DECLARE V_CNT_TR08  NUMBER;
DECLARE V_CNT_TR09  NUMBER;
DECLARE V_CNT_TR10  NUMBER;
DECLARE V_CNT_TR11  NUMBER;
DECLARE V_CNT_TR12  NUMBER;
DECLARE V_CNT_TR13  NUMBER;
DECLARE V_CNT_TR14  NUMBER;
DECLARE V_CNT_TR15  NUMBER;
DECLARE V_CNT_TR16  NUMBER;
DECLARE V_CNT_TR17  NUMBER;
DECLARE V_CNT_TR18  NUMBER;
DECLARE V_CNT_TR19  NUMBER;
DECLARE V_CNT_TR20  NUMBER;
DECLARE V_CNT_TR21  NUMBER;
DECLARE V_CNT_TR22  NUMBER;
DECLARE V_CNT_TR23  NUMBER;
DECLARE V_AMT_TR00  NUMBER;
DECLARE V_AMT_TR01  NUMBER;
DECLARE V_AMT_TR02  NUMBER;
DECLARE V_AMT_TR03  NUMBER;
DECLARE V_AMT_TR04  NUMBER;
DECLARE V_AMT_TR05  NUMBER;
DECLARE V_AMT_TR06  NUMBER;
DECLARE V_AMT_TR07  NUMBER;
DECLARE V_AMT_TR08  NUMBER;
DECLARE V_AMT_TR09  NUMBER;
DECLARE V_AMT_TR10  NUMBER;
DECLARE V_AMT_TR11  NUMBER;
DECLARE V_AMT_TR12  NUMBER;
DECLARE V_AMT_TR13  NUMBER;
DECLARE V_AMT_TR14  NUMBER;
DECLARE V_AMT_TR15  NUMBER;
DECLARE V_AMT_TR16  NUMBER;
DECLARE V_AMT_TR17  NUMBER;
DECLARE V_AMT_TR18  NUMBER;
DECLARE V_AMT_TR19  NUMBER;
DECLARE V_AMT_TR20  NUMBER;
DECLARE V_AMT_TR21  NUMBER;
DECLARE V_AMT_TR22  NUMBER;
DECLARE V_AMT_TR23  NUMBER;
   CALL PMART.P_DROP_TABLE ('#VT_OT_TCFACT_FUNC'); 
   CALL PMART.P_DROP_TABLE ('#VT_OT_TCFACT_FUNC_T1');  
    SET SQLSTR =  'CREATE MULTISET VOLATILE TABLE #VT_OT_TCFACT_FUNC  
   (
      ORG_ID		NUMBER,
      TR_ID		NUMBER,
      CNT		NUMBER,
      AMT		NUMBER
    )
   NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;';
   EXECUTE IMMEDIATE SQLSTR;   
    SET SQLSTR = 'CREATE MULTISET VOLATILE TABLE #VT_OT_TCFACT_FUNC_T1  AS('+
      'SELECT  ORG_ID,'+
      'SUM(CNT_TR00) AS CNT_TR00,SUM(CNT_TR01) AS CNT_TR01,'+
      'SUM(CNT_TR02) AS CNT_TR02,SUM(CNT_TR03) AS CNT_TR03,'+
      'SUM(CNT_TR04) AS CNT_TR04,SUM(CNT_TR05) AS CNT_TR05,'+
      'SUM(CNT_TR06) AS CNT_TR06,SUM(CNT_TR07) AS CNT_TR07,'+
      'SUM(CNT_TR08) AS CNT_TR08,SUM(CNT_TR09) AS CNT_TR09,'+
      'SUM(CNT_TR10) AS CNT_TR10,SUM(CNT_TR11) AS CNT_TR11,'+
      'SUM(CNT_TR12) AS CNT_TR12,SUM(CNT_TR13) AS CNT_TR13,'+
      'SUM(CNT_TR14) AS CNT_TR14,SUM(CNT_TR15) AS CNT_TR15,'+
      'SUM(CNT_TR16) AS CNT_TR16,SUM(CNT_TR17) AS CNT_TR17,'+
      'SUM(CNT_TR18) AS CNT_TR18,SUM(CNT_TR19) AS CNT_TR19,'+
      'SUM(CNT_TR20) AS CNT_TR20,SUM(CNT_TR21) AS CNT_TR21,'+
      'SUM(CNT_TR22) AS CNT_TR22,SUM(CNT_TR23) AS CNT_TR23,'+
      'SUM(AMT_TR00) AS AMT_TR00,SUM(AMT_TR01) AS AMT_TR01,'+
      'SUM(AMT_TR02) AS AMT_TR02,SUM(AMT_TR03) AS AMT_TR03,'+
      'SUM(AMT_TR04) AS AMT_TR04,SUM(AMT_TR05) AS AMT_TR05,'+
      'SUM(AMT_TR06) AS AMT_TR06,SUM(AMT_TR07) AS AMT_TR07,'+
      'SUM(AMT_TR08) AS AMT_TR08,SUM(AMT_TR09) AS AMT_TR09,'+
      'SUM(AMT_TR10) AS AMT_TR10,SUM(AMT_TR11) AS AMT_TR11,'+
      'SUM(AMT_TR12) AS AMT_TR12,SUM(AMT_TR13) AS AMT_TR13,'+
      'SUM(AMT_TR14) AS AMT_TR14,SUM(AMT_TR15) AS AMT_TR15,'+
      'SUM(AMT_TR16) AS AMT_TR16,SUM(AMT_TR17) AS AMT_TR17,'+
      'SUM(AMT_TR18) AS AMT_TR18,SUM(AMT_TR19) AS AMT_TR19,'+
      'SUM(AMT_TR20) AS AMT_TR20,SUM(AMT_TR21) AS AMT_TR21,'+
      'SUM(AMT_TR22) AS AMT_TR22,SUM(AMT_TR23) AS AMT_TR23 '+
      'FROM PMART.SALES_TCFACT ' +
      'WHERE TIME_ID='+ FP_TIME_ID +' ' +
      'AND ORG_ID IN ('+ FP_ORG_LIST +') AND PRD_ID='''+ FP_PRD_ID +''' '+
      'GROUP BY ORG_ID '+
    ') WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;';
	EXECUTE IMMEDIATE SQLSTR;
	L1:
	FOR CUR1  AS VT_OT_TCFACT_FUNC_C1 CURSOR  FOR 
	    SELECT ORG_ID,
      CNT_TR00 AS CNT_TR00,CNT_TR01 AS CNT_TR01,
      CNT_TR02 AS CNT_TR02,CNT_TR03 AS CNT_TR03,
      CNT_TR04 AS CNT_TR04,CNT_TR05 AS CNT_TR05,
      CNT_TR06 AS CNT_TR06,CNT_TR07 AS CNT_TR07,
      CNT_TR08 AS CNT_TR08,CNT_TR09 AS CNT_TR09,
      CNT_TR10 AS CNT_TR10,CNT_TR11 AS CNT_TR11,
      CNT_TR12 AS CNT_TR12,CNT_TR13 AS CNT_TR13,
      CNT_TR14 AS CNT_TR14,CNT_TR15 AS CNT_TR15,
      CNT_TR16 AS CNT_TR16,CNT_TR17 AS CNT_TR17,
      CNT_TR18 AS CNT_TR18,CNT_TR19 AS CNT_TR19,
      CNT_TR20 AS CNT_TR20,CNT_TR21 AS CNT_TR21,
      CNT_TR22 AS CNT_TR22,CNT_TR23 AS CNT_TR23,
      AMT_TR00 AS AMT_TR00,AMT_TR01 AS AMT_TR01,
      AMT_TR02 AS AMT_TR02,AMT_TR03 AS AMT_TR03,
      AMT_TR04 AS AMT_TR04,AMT_TR05 AS AMT_TR05,
      AMT_TR06 AS AMT_TR06,AMT_TR07 AS AMT_TR07,
      AMT_TR08 AS AMT_TR08,AMT_TR09 AS AMT_TR09,
      AMT_TR10 AS AMT_TR10,AMT_TR11 AS AMT_TR11,
      AMT_TR12 AS AMT_TR12,AMT_TR13 AS AMT_TR13,
      AMT_TR14 AS AMT_TR14,AMT_TR15 AS AMT_TR15,
      AMT_TR16 AS AMT_TR16,AMT_TR17 AS AMT_TR17,
      AMT_TR18 AS AMT_TR18,AMT_TR19 AS AMT_TR19,
      AMT_TR20 AS AMT_TR20,AMT_TR21 AS AMT_TR21,
      AMT_TR22 AS AMT_TR22,AMT_TR23 AS AMT_TR23
      FROM 	#VT_OT_TCFACT_FUNC_T1
   DO
  	  SET  V_ORG_ID = CUR1.ORG_ID;
      SET V_CNT_TR00 = CUR1.CNT_TR00;SET V_CNT_TR01 = CUR1.CNT_TR01;
      SET V_CNT_TR02 = CUR1.CNT_TR02;SET V_CNT_TR03 = CUR1.CNT_TR03;
      SET V_CNT_TR04 = CUR1.CNT_TR04;SET V_CNT_TR05 = CUR1.CNT_TR05;
      SET V_CNT_TR06 = CUR1.CNT_TR06;SET V_CNT_TR07 = CUR1.CNT_TR07;
      SET V_CNT_TR08 = CUR1.CNT_TR08;SET V_CNT_TR09 = CUR1.CNT_TR09;
      SET V_CNT_TR10 = CUR1.CNT_TR10;SET V_CNT_TR11 = CUR1.CNT_TR11;
      SET V_CNT_TR12 = CUR1.CNT_TR12;SET V_CNT_TR13 = CUR1.CNT_TR13;
      SET V_CNT_TR14 = CUR1.CNT_TR14;SET V_CNT_TR15 = CUR1.CNT_TR15;
      SET V_CNT_TR16 = CUR1.CNT_TR16;SET V_CNT_TR17 = CUR1.CNT_TR17;
      SET V_CNT_TR18 = CUR1.CNT_TR18;SET V_CNT_TR19 = CUR1.CNT_TR19;
      SET V_CNT_TR20 = CUR1.CNT_TR20;SET V_CNT_TR21 = CUR1.CNT_TR21;
      SET V_CNT_TR22 = CUR1.CNT_TR22;SET V_CNT_TR23 = CUR1.CNT_TR23;
      SET V_AMT_TR00 = CUR1.AMT_TR00;SET V_AMT_TR01 = CUR1.AMT_TR01;
      SET V_AMT_TR02 = CUR1.AMT_TR02;SET V_AMT_TR03 = CUR1.AMT_TR03;
      SET V_AMT_TR04 = CUR1.AMT_TR04;SET V_AMT_TR05 = CUR1.AMT_TR05;
      SET V_AMT_TR06 = CUR1.AMT_TR06;SET V_AMT_TR07 = CUR1.AMT_TR07;
      SET V_AMT_TR08 = CUR1.AMT_TR08;SET V_AMT_TR09 = CUR1.AMT_TR09;
      SET V_AMT_TR10 = CUR1.AMT_TR10;SET V_AMT_TR11 = CUR1.AMT_TR11;
      SET V_AMT_TR12 = CUR1.AMT_TR12;SET V_AMT_TR13 = CUR1.AMT_TR13;
      SET V_AMT_TR14 = CUR1.AMT_TR14;SET V_AMT_TR15 = CUR1.AMT_TR15;
      SET V_AMT_TR16 = CUR1.AMT_TR16;SET V_AMT_TR17 = CUR1.AMT_TR17;
      SET V_AMT_TR18 = CUR1.AMT_TR18;SET V_AMT_TR19 = CUR1.AMT_TR19;
      SET V_AMT_TR20 = CUR1.AMT_TR20;SET V_AMT_TR21 = CUR1.AMT_TR21;
      SET V_AMT_TR22 = CUR1.AMT_TR22;SET V_AMT_TR23 = CUR1.AMT_TR23;   
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,0,V_CNT_TR00,V_AMT_TR00);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,1,V_CNT_TR01,V_AMT_TR01);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,2,V_CNT_TR02,V_AMT_TR02);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,3,V_CNT_TR03,V_AMT_TR03);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,4,V_CNT_TR04,V_AMT_TR04);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,5,V_CNT_TR05,V_AMT_TR05);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,6,V_CNT_TR06,V_AMT_TR06);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,7,V_CNT_TR07,V_AMT_TR07);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,8,V_CNT_TR08,V_AMT_TR08);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,9,V_CNT_TR09,V_AMT_TR09);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,10,V_CNT_TR10,V_AMT_TR10);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,11,V_CNT_TR11,V_AMT_TR11);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,12,V_CNT_TR12,V_AMT_TR12);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,13,V_CNT_TR13,V_AMT_TR13);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,14,V_CNT_TR14,V_AMT_TR14);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,15,V_CNT_TR15,V_AMT_TR15);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,16,V_CNT_TR16,V_AMT_TR16);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,17,V_CNT_TR17,V_AMT_TR17);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,18,V_CNT_TR18,V_AMT_TR18);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,19,V_CNT_TR19,V_AMT_TR19); 
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,20,V_CNT_TR20,V_AMT_TR20);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,21,V_CNT_TR21,V_AMT_TR21);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,22,V_CNT_TR22,V_AMT_TR22);
     INSERT INTO #VT_OT_TCFACT_FUNC (ORG_ID,TR_ID,CNT,AMT) VALUES (V_ORG_ID,23,V_CNT_TR23,V_AMT_TR23);      
   END FOR L1;
END SP;