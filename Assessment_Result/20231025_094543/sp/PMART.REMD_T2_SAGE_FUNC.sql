REPLACE PROCEDURE PMART.REMD_T2_SAGE_FUNC(P_DAY_ID NUMBER, P_ORG_ID NUMBER)
SQL SECURITY INVOKER
SP:BEGIN
DECLARE SQLSTR  VARCHAR(4000) DEFAULT ''; 
  CALL PMART.P_DROP_TABLE ('#VT_REMD_T2_SAGE_FUNC'); 
      SET SQLSTR = 
          'CREATE MULTISET VOLATILE TABLE #VT_REMD_T2_SAGE_FUNC AS('+ 
               'SELECT '+
               'A.STYPE_ID AS STYPE_ID, '+
               'A.TOT_AMT AS TOT_AMT_LAST_MONTH, '+
               'A.TOT_PLAN_STNUM AS TOT_PLAN_STNUM_LAST_MONTH, '+
               'A.TOT_TKSL AS TOT_TKSL_LAST_MONTH '+
               'FROM PMART.REMD_FACT_STYPE_SUM A, '+
               '(SELECT DISTINCT SAGE_ID FROM PMART.STORE_TYPE_DIM) B, '+
               ' PMART.YMWD_TIME C '+
               'WHERE A.STYPE_ID=B.SAGE_ID AND '+
               'A.ORG_ID= '+P_ORG_ID+' AND '+
               'C.L_DAY_ID= '+P_DAY_ID+' AND '+
               'A.L_DAY_ID=C.L_DAY_LAST_DAY_LAST_MONTH '+
          ') WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;';
    EXECUTE IMMEDIATE SQLSTR; 
END SP;