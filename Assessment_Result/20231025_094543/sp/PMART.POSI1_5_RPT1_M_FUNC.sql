REPLACE PROCEDURE PMART.POSI1_5_RPT1_M_FUNC (P_L_DAY_ID VARCHAR(400),P_RPT VARCHAR(400),P_UNIT VARCHAR(400))
SQL SECURITY INVOKER
SP:BEGIN
   DECLARE SQLSTR  VARCHAR(8000); 
   DECLARE V_SELECT  VARCHAR(4000); 
   DECLARE CONTINUE HANDLER FOR SQLSTATE '52010'  
   DELETE FROM #VT_POSI1_5_RPT1_M_FUNC;  
   SET SQLSTR ='CREATE MULTISET VOLATILE TABLE #VT_POSI1_5_RPT1_M_FUNC  
               ( TIME_ID NUMBER, PRD_ID NUMBER, RESPON_ID NUMBER, SALES_AMT_PSD NUMBER, BUDGET_AMT_PSD NUMBER, 
                  INPRD_RATE NUMBER, BUDGET_RATE NUMBER, GPR NUMBER, BUDGET_GRP NUMBER, REAL_SALES_AMT NUMBER,BUDGET_AMT NUMBER) 
                NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;';
   EXECUTE IMMEDIATE SQLSTR;
   CALL PMART.P_DROP_TABLE ('#VT_POSI1_5_RPT1_M_FUNC_TEMP'); 
   SET SQLSTR ='CREATE MULTISET VOLATILE TABLE #VT_POSI1_5_RPT1_M_FUNC_TEMP  
               ( TIME_ID NUMBER, PRD_ID NUMBER, RESPON_ID NUMBER, SALES_AMT_PSD NUMBER, BUDGET_AMT_PSD NUMBER, 
                  INPRD_RATE NUMBER, BUDGET_RATE NUMBER, GPR NUMBER, BUDGET_GRP NUMBER, REAL_SALES_AMT NUMBER,BUDGET_AMT NUMBER) 
                NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;';
   EXECUTE IMMEDIATE SQLSTR;
   IF(P_UNIT='GRP') THEN
       SET V_SELECT =' CASE WHEN T.UPLOAD_STNUM > 0 THEN (T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+
           ' T.BUDGET_PSD , '+
           ' CASE WHEN T.SL2_0103R > 0 THEN (T.SL2_0103R-T.CS_0103R)/(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
           ' CASE WHEN T.BUDGET_AMT > 0 THEN (T.BUDGET_AMT-T.BUDGET_COST)/(CAST(T.BUDGET_AMT AS DECIMAL(17,6)))*100 ELSE 0 END , '+
           ' T.SALES_UNTAX_AMT-T.DIS_UNTAX_AMT-T.SUB_UNTAX_AMT-T.SALES_UNTAX_COST , '+
           ' T.BUDGET_UNTAX_AMT*BUDGET_GPR/100 , '+
           ' T.SALES_AMT-T.DIS_AMT-T.SUB_AMT , '+
           ' BUDGET_AMT ';
   END IF;
   IF(P_UNIT <>'GRP') THEN
       SET V_SELECT = ' CASE WHEN MAX(T.UPLOAD_STNUM) > 0 THEN SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/MAX(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+
           ' SUM(T.BUDGET_PSD) , '+
           ' CASE WHEN SUM(T.SL2_0103R) > 0 THEN SUM(T.SL2_0103R-T.CS_0103R)/SUM(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
           ' CASE WHEN SUM(T.BUDGET_AMT) > 0 THEN SUM(T.BUDGET_AMT-T.BUDGET_COST)/SUM(CAST(T.BUDGET_AMT AS DECIMAL(17,6)))*100 ELSE 0 END , '+
           ' SUM(T.SALES_UNTAX_AMT-T.DIS_UNTAX_AMT-T.SUB_UNTAX_AMT-T.SALES_UNTAX_COST) , '+
           ' SUM(T.BUDGET_UNTAX_AMT*BUDGET_GPR/100) , '+
           ' SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) , '+
           ' SUM(BUDGET_AMT) ';
   END IF;
   IF (P_RPT='RPT1_1' AND P_UNIT='GRP' ) THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                        ' SELECT T.TIME_ID,T.PRD_ID,0, '+
                        ' '+V_SELECT+' '+
                        ' FROM PMART.BASIC_MFACT_BUDGET T  '+
                        ' WHERE TIME_ID =('+ P_L_DAY_ID +') ';
   END IF;
   IF (P_RPT='RPT1_3' AND P_UNIT='GRP' ) THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                        ' SELECT T.TIME_ID,T.PRD_ID,A.RESPON_ID AS RESPON_ID, '+
                        ' '+V_SELECT+' '+
                        ' FROM (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) A LEFT JOIN PMART.BASIC_MFACT_BUDGET T ON (T.PRD_ID=A.GRP_ID) '+
                        ' WHERE TIME_ID =('+ P_L_DAY_ID +') ';
   END IF;
   IF (P_RPT='RPT2_1' AND P_UNIT='GRP' ) THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                       ' SELECT T.TIME_ID,T.PRD_ID,0, '+
                       ' '+V_SELECT+' '+
                       ' FROM PMART.BASIC_MFACT_BUDGET T '+
                       ' WHERE TIME_ID =('+ P_L_DAY_ID +') ';
   END IF;
   IF (P_RPT='RPT2_3' AND P_UNIT='GRP' ) THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                        ' SELECT T.TIME_ID,T.PRD_ID,A.RESPON_ID AS RESPON_ID, '+
                        ' '+V_SELECT+' '+
                        ' FROM (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) A LEFT JOIN PMART.BASIC_MFACT_BUDGET T ON (T.PRD_ID=A.GRP_ID) '+
                        ' WHERE TIME_ID =('+ P_L_DAY_ID +') ';
   END IF;
   IF (P_RPT='RPT1_1' AND P_UNIT='KND' ) THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC_TEMP(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                        ' SELECT T.TIME_ID,A.KND_ID,0, '+
                        ' '+V_SELECT+' '+
                        ' FROM PMART.BASIC_MFACT_BUDGET T '+
                        ' , (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) A '+
                        ' WHERE TIME_ID =('+ P_L_DAY_ID +') '+
                        ' AND T.PRD_ID = A.GRP_ID '+
                        ' GROUP BY T.TIME_ID,A.KND_ID ';
	EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR = 'INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
							'  SELECT  '+ P_L_DAY_ID +', NVL(R.PRD_ID, O.KND_ID) AS PRD_ID, 0 AS RESPON_ID, R.SALES_AMT_PSD, R.BUDGET_AMT_PSD, R.INPRD_RATE, '+
							'   R.BUDGET_RATE, R.GPR, R.BUDGET_GRP, R.REAL_SALES_AMT, R.BUDGET_AMT '+
							' FROM (SELECT DISTINCT KND_ID FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) O '+
							' LEFT JOIN #VT_POSI1_5_RPT1_M_FUNC_TEMP R ON O.KND_ID = R.PRD_ID ';		
   END IF;
   IF (P_RPT='RPT1_2' AND P_UNIT='KND' ) THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC_TEMP(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                        ' SELECT T.TIME_ID,A.KND_ID,A.RESPON_ID AS RESPON_ID, '+
                        ' '+V_SELECT+' '+
                        ' FROM PMART.BASIC_MFACT_BUDGET T '+
                        ' , (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) A '+
                        ' WHERE TIME_ID =('+ P_L_DAY_ID +') '+
                        ' AND T.PRD_ID = A.GRP_ID '+
                        ' GROUP BY T.TIME_ID,A.RESPON_ID,A.KND_ID ';
	EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR = 'INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
							'  SELECT  '+ P_L_DAY_ID +', NVL(R.PRD_ID, O.KND_ID) AS PRD_ID, NVL(R.RESPON_ID, O.RESPON_ID) AS RESPON_ID, R.SALES_AMT_PSD, R.BUDGET_AMT_PSD, R.INPRD_RATE, '+
							'   R.BUDGET_RATE, R.GPR, R.BUDGET_GRP, R.REAL_SALES_AMT, R.BUDGET_AMT '+
							' FROM (SELECT DISTINCT KND_ID, RESPON_ID FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) O '+
							' LEFT JOIN #VT_POSI1_5_RPT1_M_FUNC_TEMP R ON O.KND_ID = R.PRD_ID AND O.RESPON_ID = R.RESPON_ID';								
   END IF;
   IF (P_RPT='RPT2_1' AND P_UNIT='KND' ) THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC_TEMP(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                        ' SELECT T.TIME_ID,A.KND_ID,0, '+
                        ' '+V_SELECT+' '+
                        ' FROM PMART.BASIC_MFACT_BUDGET T '+
                        ' , (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) A '+
                        ' WHERE TIME_ID = ('+ P_L_DAY_ID +') '+
                        ' AND T.PRD_ID = A.GRP_ID '+
                        ' GROUP BY T.TIME_ID,A.KND_ID ';
	EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR = 'INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
							'  SELECT  '+ P_L_DAY_ID +', NVL(R.PRD_ID, O.KND_ID) AS PRD_ID, 0 AS RESPON_ID, R.SALES_AMT_PSD, R.BUDGET_AMT_PSD, R.INPRD_RATE, '+
							'   R.BUDGET_RATE, R.GPR, R.BUDGET_GRP, R.REAL_SALES_AMT, R.BUDGET_AMT '+
							' FROM (SELECT DISTINCT KND_ID FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) O '+
							' LEFT JOIN #VT_POSI1_5_RPT1_M_FUNC_TEMP R ON O.KND_ID = R.PRD_ID ';				 
   END IF;
   IF (P_RPT='RPT2_2' AND P_UNIT='KND' ) THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC_TEMP(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                        ' SELECT T.TIME_ID,A.KND_ID,A.RESPON_ID AS RESPON_ID, '+
                        ' '+V_SELECT+' '+
                        ' FROM PMART.BASIC_MFACT_BUDGET T '+
                        ' , (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) A '+
                        ' WHERE TIME_ID =('+ P_L_DAY_ID +') '+
                        ' AND T.PRD_ID = A.GRP_ID '+
                        ' GROUP BY T.TIME_ID,A.RESPON_ID,A.KND_ID ';
	EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR = 'INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
							'  SELECT  '+ P_L_DAY_ID +', NVL(R.PRD_ID, O.KND_ID) AS PRD_ID, NVL(R.RESPON_ID, O.RESPON_ID) AS RESPON_ID, R.SALES_AMT_PSD, R.BUDGET_AMT_PSD, R.INPRD_RATE, '+
							'   R.BUDGET_RATE, R.GPR, R.BUDGET_GRP, R.REAL_SALES_AMT, R.BUDGET_AMT '+
							' FROM (SELECT DISTINCT KND_ID, RESPON_ID FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) O '+
							' LEFT JOIN #VT_POSI1_5_RPT1_M_FUNC_TEMP R ON O.KND_ID = R.PRD_ID AND O.RESPON_ID = R.RESPON_ID';										
   END IF;
   IF (P_RPT='RPT1_1' AND P_UNIT='RESPON') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC_TEMP(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                        ' SELECT T.TIME_ID,B.RESPON_ID AS PRD_ID,0, '+
                        ' '+V_SELECT+' '+
                        ' FROM PMART.BASIC_MFACT_BUDGET T '+
                        ' , (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
                        ' WHERE TIME_ID =('+ P_L_DAY_ID +') '+
                        ' AND T.PRD_ID = B.GRP_ID '+
                        ' GROUP BY T.TIME_ID,B.RESPON_ID ';
	 EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR = 'INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
							'  SELECT  '+ P_L_DAY_ID +', NVL(R.PRD_ID, O.RESPON_ID) AS PRD_ID, 0 AS RESPON_ID, R.SALES_AMT_PSD, R.BUDGET_AMT_PSD, R.INPRD_RATE, '+
							'   R.BUDGET_RATE, R.GPR, R.BUDGET_GRP, R.REAL_SALES_AMT, R.BUDGET_AMT '+
							' FROM (SELECT  DISTINCT RESPON_ID FROM PMART.ORG_DIM_POSI1 WHERE SEQNO = 1) O '+
							' LEFT JOIN #VT_POSI1_5_RPT1_M_FUNC_TEMP R ON O.RESPON_ID = R.PRD_ID ';		
   END IF;
   IF (P_RPT='RPT2_1' AND P_UNIT='RESPON') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC_TEMP(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                       ' SELECT T.TIME_ID,B.RESPON_ID AS PRD_ID,0, '+
                       ' '+V_SELECT+' '+
                       ' FROM PMART.BASIC_MFACT_BUDGET T '+
                       ' , (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
                       ' WHERE TIME_ID = ('+ P_L_DAY_ID +') '+
                       ' AND T.PRD_ID = B.GRP_ID '+
                       ' GROUP BY T.TIME_ID,B.RESPON_ID ';
	EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR = 'INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
							'  SELECT  '+ P_L_DAY_ID +', NVL(R.PRD_ID, O.RESPON_ID) AS PRD_ID, 0 AS RESPON_ID, R.SALES_AMT_PSD, R.BUDGET_AMT_PSD, R.INPRD_RATE, '+
							'   R.BUDGET_RATE, R.GPR, R.BUDGET_GRP, R.REAL_SALES_AMT, R.BUDGET_AMT '+
							' FROM (SELECT  DISTINCT RESPON_ID FROM PMART.ORG_DIM_POSI1 WHERE SEQNO = 1) O '+
							' LEFT JOIN #VT_POSI1_5_RPT1_M_FUNC_TEMP R ON O.RESPON_ID = R.PRD_ID ';		
   END IF;
   IF (P_RPT='RPT1_1' AND P_UNIT='BIGKND') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                        ' SELECT T.TIME_ID,B.PRD_ID,0, '+
                        ' '+V_SELECT+' '+
                        ' FROM PMART.BASIC_MFACT_BUDGET T '+
                        ' , (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) A , PRD_DIM_POSI1 B '+
                        ' WHERE TIME_ID =('+ P_L_DAY_ID +') '+
                        ' AND T.PRD_ID = A.GRP_ID '+
                        ' AND A.KND_ID = B.KND_ID '+
                        ' GROUP BY T.TIME_ID,B.PRD_ID ';
   END IF;
   IF (P_RPT='RPT2_1' AND P_UNIT='BIGKND') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                        ' SELECT T.TIME_ID,B.PRD_ID,0, '+
                        ' '+V_SELECT+' '+
                        ' FROM PMART.BASIC_MFACT_BUDGET T '+
                        ' , (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) A , PRD_DIM_POSI1 B '+
                        ' WHERE TIME_ID = ('+ P_L_DAY_ID +') '+
                        ' AND T.PRD_ID = A.GRP_ID '+
                        ' AND A.KND_ID = B.KND_ID '+
                        ' GROUP BY T.TIME_ID,B.PRD_ID ';
   END IF;
   IF (P_RPT='RPT1_1' AND P_UNIT='BRANCH') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC_TEMP(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                        ' SELECT T.TIME_ID,B.BRANCH_ID AS PRD_ID,0, '+
                        ' '+V_SELECT+' '+
                        ' FROM PMART.BASIC_MFACT_BUDGET T '+
                        ' , (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
                        ' WHERE TIME_ID =('+ P_L_DAY_ID +') '+
                        ' AND T.PRD_ID = B.GRP_ID '+
                        ' GROUP BY T.TIME_ID,B.BRANCH_ID ';
	EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR = 'INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
							'  SELECT  '+ P_L_DAY_ID +', NVL(R.PRD_ID, O.BRANCH_ID) AS PRD_ID, 0 AS RESPON_ID, R.SALES_AMT_PSD, R.BUDGET_AMT_PSD, R.INPRD_RATE, '+
							'   R.BUDGET_RATE, R.GPR, R.BUDGET_GRP, R.REAL_SALES_AMT, R.BUDGET_AMT '+
							' FROM (SELECT  DISTINCT BRANCH_ID FROM PMART.ORG_DIM_POSI1) O '+
							' LEFT JOIN #VT_POSI1_5_RPT1_M_FUNC_TEMP R ON O.BRANCH_ID = R.PRD_ID ';							
   END IF;
   IF (P_RPT='RPT2_1' AND P_UNIT='BRANCH') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC_TEMP(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                        ' SELECT T.TIME_ID,B.BRANCH_ID AS PRD_ID,0, '+
                        ' '+V_SELECT+' '+
                        ' FROM PMART.BASIC_MFACT_BUDGET T '+
                        ' , (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
                        ' WHERE TIME_ID = ('+ P_L_DAY_ID +') '+
                        ' AND T.PRD_ID = B.GRP_ID '+
                        ' GROUP BY T.TIME_ID,B.BRANCH_ID ';
	 EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR = 'INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
							'  SELECT  '+ P_L_DAY_ID +', NVL(R.PRD_ID, O.BRANCH_ID) AS PRD_ID, 0 AS RESPON_ID, R.SALES_AMT_PSD, R.BUDGET_AMT_PSD, R.INPRD_RATE, '+
							'   R.BUDGET_RATE, R.GPR, R.BUDGET_GRP, R.REAL_SALES_AMT, R.BUDGET_AMT '+
							' FROM (SELECT  DISTINCT BRANCH_ID FROM PMART.ORG_DIM_POSI1) O '+
							' LEFT JOIN #VT_POSI1_5_RPT1_M_FUNC_TEMP R ON O.BRANCH_ID = R.PRD_ID ';									
   END IF;
   IF (P_RPT='RPT1_1' AND P_UNIT='DEPT') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                        ' SELECT T.TIME_ID,B.DEPT_ID AS PRD_ID,0, '+
                        ' '+V_SELECT+' '+
                        ' FROM PMART.BASIC_MFACT_BUDGET T '+
                        ' , (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
                        ' WHERE TIME_ID =('+ P_L_DAY_ID +') '+
                        ' AND T.PRD_ID = B.GRP_ID '+
                        ' GROUP BY T.TIME_ID,B.DEPT_ID ';
   END IF;
   IF (P_RPT='RPT2_1' AND P_UNIT='DEPT') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                        ' SELECT T.TIME_ID,B.DEPT_ID AS PRD_ID,0, '+
                        ' '+V_SELECT+' '+
                        ' FROM PMART.BASIC_MFACT_BUDGET T '+
                        ' , (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
                        ' WHERE TIME_ID = ('+ P_L_DAY_ID +') '+
                        ' AND T.PRD_ID = B.GRP_ID '+
                        ' GROUP BY T.TIME_ID,B.DEPT_ID ';
   END IF;
      IF (P_RPT='RPT1_1' AND P_UNIT='TOT') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                      ' SELECT T.TIME_ID,B.TOT_ID AS PRD_ID,0, '+
                      ' '+V_SELECT+' '+
                      ' FROM PMART.BASIC_MFACT_BUDGET T '+
                      ' , (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
                      ' WHERE TIME_ID =('+ P_L_DAY_ID +') '+
                      ' AND T.PRD_ID = B.GRP_ID '+
                      ' GROUP BY T.TIME_ID, B.TOT_ID ';
   END IF;
   IF (P_RPT='RPT2_1' AND P_UNIT='TOT') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                       ' SELECT T.TIME_ID,B.TOT_ID AS PRD_ID,0, '+
                       ' '+V_SELECT+' '+
                       ' FROM PMART.BASIC_MFACT_BUDGET T '+
                       ' , (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
                       ' WHERE TIME_ID = ('+ P_L_DAY_ID +') '+
                       ' AND T.PRD_ID = B.GRP_ID '+
                       ' GROUP BY T.TIME_ID, B.TOT_ID ';
   END IF;     
   IF (P_RPT='RPT1_1' AND P_UNIT='ALL') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                      ' SELECT T.TIME_ID,-99 AS PRD_ID,0, '+
                      ' '+V_SELECT+' '+
                      ' FROM PMART.BASIC_MFACT_BUDGET T '+
                      ' , (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
                      ' WHERE TIME_ID =('+ P_L_DAY_ID +') '+
                      ' AND T.PRD_ID = B.GRP_ID '+
                      ' GROUP BY T.TIME_ID ';
   END IF;
   IF (P_RPT='RPT2_1' AND P_UNIT='ALL') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_M_FUNC(TIME_ID  ,PRD_ID  ,RESPON_ID  ,SALES_AMT_PSD ,BUDGET_AMT_PSD ,INPRD_RATE  ,BUDGET_RATE  ,GPR   ,BUDGET_GRP  ,REAL_SALES_AMT ,BUDGET_AMT  ) '+
                       ' SELECT T.TIME_ID,-99 AS PRD_ID,0, '+
                       ' '+V_SELECT+' '+
                       ' FROM PMART.BASIC_MFACT_BUDGET T '+
                       ' , (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
                       ' WHERE TIME_ID = ('+ P_L_DAY_ID +') '+
                       ' AND T.PRD_ID = B.GRP_ID '+
                       ' GROUP BY T.TIME_ID ';
   END IF;     
	EXECUTE IMMEDIATE SQLSTR;
END SP;