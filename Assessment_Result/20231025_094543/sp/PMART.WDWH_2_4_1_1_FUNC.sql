REPLACE PROCEDURE PMART.WDWH_2_4_1_1_FUNC
(
	I_YYYYMM_S VARCHAR(10),
	I_YYYYMM_E VARCHAR(10),
	I_ORG_LEVEL VARCHAR(100),
	I_ORG_ID VARCHAR(100),
	I_KND_TYPE VARCHAR(100),
	I_STK_TYPE VARCHAR(100),
	I_STK_CMP VARCHAR(100),
	I_STK_NUM VARCHAR(100)
)
SQL SECURITY INVOKER
SP:BEGIN
	DECLARE SQLSTR VARCHAR(10000);
	DECLARE V_SQLSTR VARCHAR(10000);
	CALL PMART.P_DROP_TABLE ('#VT_WDWH_2_4_1_1_FUNC');
	IF I_ORG_LEVEL = '-2' AND I_STK_TYPE = '0' THEN
		SET V_SQLSTR =  'SELECT S.YYYYMM AS V_YYYYMM, '
									+ '''-1'' AS V_PDEPT_ID, '
									+ '''-1'' AS V_DEPT_ID, '
									+ '''-1'' AS V_BRANCH_ID, '
									+ '''-1'' AS V_SREMP_NO, '
									+ 'CAST(-1 AS INTEGER) AS V_OST_NO, '
									+ 'S.KND_TYPE AS V_KND_TYPE, '
									+ 'CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2))) AS DECIMAL(12,2)) AS V_STK_AMT, ' 
									+ 'CASE WHEN SUM(S.WORKDAYS) = 0 THEN 0 ELSE (SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) END AS V_SALES_CNT_PSD, ' 
									+ 'CASE WHEN SUM(S.SALES_AMT_SUM) = 0 THEN 0 ELSE CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2)))/(SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) AS DECIMAL(12,2)) END AS V_STK_DAYS ' 
									+ 'FROM PDATA.WDWH_CAL_STK_MONTH_AC S '
									+ 'WHERE S.YYYYMM >= '+ I_YYYYMM_S +' '
									+ 'AND S.YYYYMM <= '+ I_YYYYMM_E +' '
									+ 'AND S.KND_TYPE = '''+ I_KND_TYPE +''' '
									+ 'GROUP BY S.YYYYMM, '
									+ 'S.KND_TYPE ';
	ELSEIF I_ORG_LEVEL = '-1' AND I_STK_TYPE = '0' THEN
		SET V_SQLSTR =  'SELECT S.YYYYMM AS V_YYYYMM, '
									+ 'S.PDEPT_ID AS V_PDEPT_ID, '
									+ '''-1'' AS V_DEPT_ID, '
									+ '''-1'' AS V_BRANCH_ID, '
									+ '''-1'' AS V_SREMP_NO, '
									+ 'CAST(-1 AS INTEGER) AS V_OST_NO, '
									+ 'S.KND_TYPE AS V_KND_TYPE, '
									+ 'CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2))) AS DECIMAL(12,2)) AS V_STK_AMT, ' 
									+ 'CASE WHEN SUM(S.WORKDAYS) = 0 THEN 0 ELSE (SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) END AS V_SALES_CNT_PSD,' 
									+ 'CASE WHEN SUM(S.SALES_AMT_SUM) = 0 THEN 0 ELSE CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2)))/(SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) AS DECIMAL(12,2)) END AS V_STK_DAYS '
									+ 'FROM PDATA.WDWH_CAL_STK_MONTH_AC S '
									+ 'WHERE S.YYYYMM >= '+ I_YYYYMM_S +' '
									+ 'AND S.YYYYMM <= '+ I_YYYYMM_E +' '
									+ 'AND S.KND_TYPE = '''+ I_KND_TYPE +''' '
									+ 'GROUP BY S.YYYYMM,'
									+ 'S.PDEPT_ID, '
									+ 'S.KND_TYPE ';
	ELSEIF I_ORG_LEVEL = '0' AND I_STK_TYPE = '0' THEN
		SET V_SQLSTR =  'SELECT S.YYYYMM AS V_YYYYMM, '
									+ 'S.PDEPT_ID AS V_PDEPT_ID, '
									+ 'S.DEPT_ID AS V_DEPT_ID, '
									+ '''-1'' AS V_BRANCH_ID, '
									+ '''-1'' AS V_SREMP_NO, '
									+ 'CAST(-1 AS INTEGER) AS V_OST_NO, '
									+ 'S.KND_TYPE AS V_KND_TYPE, '
									+ 'CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2))) AS DECIMAL(12,2)) AS V_STK_AMT, ' 
									+ 'CASE WHEN SUM(S.WORKDAYS) = 0 THEN 0 ELSE (SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) END AS V_SALES_CNT_PSD,' 
									+ 'CASE WHEN SUM(S.SALES_AMT_SUM) = 0 THEN 0 ELSE CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2)))/(SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) AS DECIMAL(12,2)) END AS V_STK_DAYS '
									+ 'FROM PDATA.WDWH_CAL_STK_MONTH_AC S '
									+ 'WHERE S.YYYYMM >= '+ I_YYYYMM_S +' '
									+ 'AND S.YYYYMM <= '+ I_YYYYMM_E +' '
									+ 'AND S.KND_TYPE = '''+ I_KND_TYPE +''' '
									+ 'GROUP BY S.YYYYMM,'
									+ 'S.PDEPT_ID,'
									+ 'S.DEPT_ID,'
									+ 'S.KND_TYPE ';
	ELSEIF I_ORG_LEVEL = '1' AND I_STK_TYPE = '0' THEN
		SET V_SQLSTR =  'SELECT S.YYYYMM AS V_YYYYMM, '
									+ 'S.PDEPT_ID AS V_PDEPT_ID, '
									+ 'S.DEPT_ID AS V_DEPT_ID, '
									+ 'S.BRANCH_ID AS V_BRANCH_ID, '
									+ '''-1'' AS V_SREMP_NO, '
									+ 'CAST(-1 AS INTEGER) AS V_OST_NO, '
									+ 'S.KND_TYPE AS V_KND_TYPE, '
									+ 'CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2))) AS DECIMAL(12,2)) AS V_STK_AMT, ' 
									+ 'CASE WHEN SUM(S.WORKDAYS) = 0 THEN 0 ELSE (SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) END AS V_SALES_CNT_PSD,' 
									+ 'CASE WHEN SUM(S.SALES_AMT_SUM) = 0 THEN 0 ELSE CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2)))/(SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) AS DECIMAL(12,2)) END AS V_STK_DAYS ' 
									+ 'FROM PDATA.WDWH_CAL_STK_MONTH_AC S '
									+ 'WHERE S.YYYYMM >= '+ I_YYYYMM_S +' '
									+ 'AND S.YYYYMM <= '+ I_YYYYMM_E +' '
									+ 'AND S.KND_TYPE = '''+ I_KND_TYPE +''' '
									+ 'AND S.DEPT_ID = '''+ I_ORG_ID +''' '
									+ 'GROUP BY S.YYYYMM, '
									+ 'S.PDEPT_ID, '
									+ 'S.DEPT_ID,'
									+ 'S.BRANCH_ID,'
									+ 'S.KND_TYPE ';
	ELSEIF I_ORG_LEVEL = '2' AND I_STK_TYPE = '0' THEN
		SET V_SQLSTR =  'SELECT S.YYYYMM AS V_YYYYMM, '
									+ 'S.PDEPT_ID AS V_PDEPT_ID, '
									+ 'S.DEPT_ID AS V_DEPT_ID, '
									+ 'S.BRANCH_ID AS V_BRANCH_ID, '
									+ 'B.RESPON_NO AS V_SREMP_NO, '
									+ 'CAST(-1 AS INTEGER) AS V_OST_NO, '
									+ 'S.KND_TYPE AS V_KND_TYPE, '
									+ 'CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2)))  AS DECIMAL(12,2)) AS V_STK_AMT, ' 
									+ 'CASE WHEN SUM(S.WORKDAYS) = 0 THEN 0 ELSE (SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) END AS V_SALES_CNT_PSD, ' 
									+ 'CASE WHEN SUM(S.SALES_AMT_SUM) = 0 THEN 0 ELSE CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2)))/(SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) AS DECIMAL(12,2)) END AS V_STK_DAYS ' 
									+ 'FROM PDATA.WDWH_CAL_STK_MONTH_AC S  INNER JOIN  '
									+ ' ( SELECT DISTINCT OSTORE_ID, M.RESPON_NO ' 
									+ '   FROM PMART.LAST_ORG_DIM M ' 
									+ '  WHERE M.BRANCH_NO = '''+ I_ORG_ID +''' '
									+ ') B ON S.OSTORE_NO=B.OSTORE_ID  ' 
									+ 'WHERE S.YYYYMM >= '+ I_YYYYMM_S +' '
									+ 'AND S.YYYYMM <= '+ I_YYYYMM_E +' '
									+ 'AND S.KND_TYPE = '''+ I_KND_TYPE +''' '
									+ 'AND S.BRANCH_ID = '''+ I_ORG_ID +''' '
									+ 'GROUP BY S.YYYYMM, '
									+ 'S.PDEPT_ID, '
									+ 'S.DEPT_ID, '
									+ 'S.BRANCH_ID,'
									+ 'B.RESPON_NO, '
									+ 'S.KND_TYPE ';
	ELSEIF I_ORG_LEVEL = '3' AND I_STK_TYPE = '0' THEN
		SET V_SQLSTR =  'SELECT T.YYYYMM AS V_YYYYMM, '
									+ 'T.PDEPT_ID AS V_PDEPT_ID, '
									+ 'T.DEPT_ID AS V_DEPT_ID, '
									+ 'T.BRANCH_ID AS V_BRANCH_ID, '
									+ 'B.RESPON_NO AS V_SREMP_NO, '
									+ 'T.OSTORE_NO AS V_OST_NO, '
									+ 'T.KND_TYPE AS V_KND_TYPE, '
									+ 'CAST(T.STK_AMT AS DECIMAL(12,2)) AS V_STK_AMT, ' 
									+ 'CASE WHEN T.WORKDAYS = 0 THEN 0 ELSE (CAST(T.SALES_AMT_SUM AS DECIMAL(12,2)) /T.WORKDAYS) END AS V_SALES_CNT_PSD,' 
									+ 'CASE WHEN T.SALES_AMT_SUM = 0 THEN 0 ELSE (CAST(T.STK_AMT*T.WORKDAYS AS DECIMAL(12,2))/T.SALES_AMT_SUM) END AS V_STK_DAYS ' 
									+ 'FROM PDATA.WDWH_CAL_STK_MONTH_AC T INNER JOIN '
									+ ' ( SELECT DISTINCT OSTORE_ID, M.RESPON_NO ' 
									+ '   FROM PMART.LAST_ORG_DIM M ' 
									+ '  WHERE M.RESPON_NO ='''+ I_ORG_ID +''' '
									+ ') B ON T.OSTORE_NO=B.OSTORE_ID  ' 
									+ 'WHERE T.YYYYMM >= '+ I_YYYYMM_S +' '
									+ 'AND T.YYYYMM <= '+ I_YYYYMM_E +' '
									+ 'AND T.KND_TYPE = '''+ I_KND_TYPE +''' '
									+ 'AND B.RESPON_NO = '''+ I_ORG_ID +''' ';
	ELSEIF I_ORG_LEVEL = '4' AND I_STK_TYPE = '0' THEN
		SET V_SQLSTR =  'SELECT T.YYYYMM AS V_YYYYMM, '
									+ 'T.PDEPT_ID AS V_PDEPT_ID, '
									+ 'T.DEPT_ID AS V_DEPT_ID, '
									+ 'T.BRANCH_ID AS V_BRANCH_ID, '
									+ 'B.RESPON_NO AS V_SREMP_NO, '
									+ 'T.OSTORE_NO AS V_OST_NO, '
									+ 'T.KND_TYPE AS V_KND_TYPE, '
									+ 'CAST(T.STK_AMT AS DECIMAL(12,2)) AS V_STK_AMT, ' 
									+ 'CASE WHEN T.WORKDAYS = 0 THEN 0 ELSE (CAST(T.SALES_AMT_SUM AS DECIMAL(12,2)) /T.WORKDAYS) END AS V_SALES_CNT_PSD,' 
									+ 'CASE WHEN T.SALES_AMT_SUM = 0 THEN 0 ELSE (CAST(T.STK_AMT*T.WORKDAYS  AS DECIMAL(12,2))/T.SALES_AMT_SUM) END AS V_STK_DAYS ' 
									+ 'FROM PDATA.WDWH_CAL_STK_MONTH_AC T INNER JOIN  '
									+ ' ( SELECT DISTINCT OSTORE_ID, M.RESPON_NO ' 
									+ '    FROM PMART.LAST_ORG_DIM M ' 
									+ '  WHERE M.OSTORE_ID ='+ I_ORG_ID +' '
									+ ') B ON T.OSTORE_NO=B.OSTORE_ID  ' 
									+ 'WHERE T.YYYYMM >= '+ I_YYYYMM_S +' '
									+ 'AND T.YYYYMM <= '+ I_YYYYMM_E +' '
									+ 'AND T.KND_TYPE = '''+ I_KND_TYPE +''' '
									+ 'AND T.OSTORE_NO = '+ I_ORG_ID +' ';
	ELSEIF I_ORG_LEVEL = '4' AND I_STK_TYPE = '1' THEN
		SET V_SQLSTR =  'SELECT S.YYYYMM AS V_YYYYMM,'
									+ 'S.PDEPT_ID AS V_PDEPT_ID, '
									+ 'S.DEPT_ID AS V_DEPT_ID, '
									+ 'S.BRANCH_ID AS V_BRANCH_ID, '
									+ 'B.RESPON_NO AS SREMP_NO, '
									+ 'S.OSTORE_NO AS V_OST_NO, '
									+ 'S.KND_TYPE AS V_KND_TYPE, '
									+ 'CAST(S.STK_AMT AS DECIMAL(12,2)) AS V_STK_AMT, ' 
									+ 'CASE WHEN S.WORKDAYS = 0 THEN 0 ELSE (CAST(S.SALES_AMT_SUM AS DECIMAL(12,2)) / S.WORKDAYS) END AS V_SALES_CNT_PSD,' 
									+ 'CAST(S.STK_DAYS AS DECIMAL(12,2)) AS V_STK_DAYS ' 
									+ 'FROM PDATA.WDWH_CAL_STK_MONTH_AC S INNER JOIN  '
									+ ' ( SELECT DISTINCT OSTORE_ID, M.RESPON_NO ' 
									+ '    FROM PMART.LAST_ORG_DIM M ' 
									+ '  WHERE M.OSTORE_ID ='+ I_ORG_ID +' '
									+ ') B ON S.OSTORE_NO=B.OSTORE_ID  ' 
									+ 'WHERE S.YYYYMM >= '+ I_YYYYMM_S +' '
									+ 'AND S.YYYYMM <= '+ I_YYYYMM_E +' '
									+ 'AND S.KND_TYPE = '''+ I_KND_TYPE +''' '
									+ 'AND S.OSTORE_NO = '+ I_ORG_ID +' ';
	ELSEIF I_ORG_LEVEL = '3' AND I_STK_TYPE = '1' THEN
		SET V_SQLSTR =  'SELECT S.YYYYMM AS V_YYYYMM, '
									+ 'S.PDEPT_ID AS V_PDEPT_ID, '
									+ 'S.DEPT_ID AS V_DEPT_ID, '
									+ 'S.BRANCH_ID AS V_BRANCH_ID, '
									+ 'B.RESPON_NO AS V_SREMP_NO, '
									+ 'S.OSTORE_NO AS V_OST_NO, '
									+ 'S.KND_TYPE AS V_KND_TYPE, '
									+ 'CAST(S.STK_AMT AS DECIMAL(12,2)) AS V_STK_AMT, ' 
									+ 'CASE WHEN S.WORKDAYS = 0 THEN 0 ELSE (CAST(S.SALES_AMT_SUM AS DECIMAL(12,2)) / S.WORKDAYS) END AS V_SALES_CNT_PSD,' 
									+ 'CAST(S.STK_DAYS AS DECIMAL(12,2)) AS V_STK_DAYS ' 
									+ 'FROM PDATA.WDWH_CAL_STK_MONTH_AC S INNER JOIN  '
									+ ' ( SELECT DISTINCT OSTORE_ID, M.RESPON_NO ' 
									+ '   FROM PMART.LAST_ORG_DIM M ' 
									+ '  WHERE M.RESPON_NO ='''+ I_ORG_ID +''' '
									+ ') B ON S.OSTORE_NO=B.OSTORE_ID  ' 
									+ 'WHERE S.YYYYMM >= '+ I_YYYYMM_S +' '
									+ 'AND S.YYYYMM <= '+ I_YYYYMM_E +' '
									+ 'AND B.RESPON_NO= '''+ I_ORG_ID +''' '
									+ 'AND S.KND_TYPE = '''+ I_KND_TYPE +''' ';
	ELSEIF I_ORG_LEVEL = '2' AND I_STK_TYPE = '1' THEN
		SET V_SQLSTR =  'SELECT S.YYYYMM AS V_YYYYMM,'
									+ 'S.PDEPT_ID AS V_PDEPT_ID, '
									+ 'S.DEPT_ID AS V_DEPT_ID, '
									+ 'S.BRANCH_ID AS V_BRANCH_ID, '
									+ 'B.RESPON_NO AS V_SREMP_NO, '
									+ 'CAST(-1 AS INTEGER) AS V_OST_NO, '
									+ 'S.KND_TYPE AS V_KND_TYPE, '
									+ 'CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2))) AS DECIMAL(12,2)) AS V_STK_AMT, ' 
									+ 'CASE WHEN SUM(S.WORKDAYS) = 0 THEN 0 ELSE (SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) END AS V_SALES_CNT_PSD,' 
									+ 'CASE WHEN SUM(S.SALES_AMT_SUM) = 0 THEN 0 ELSE CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2)))/(SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) AS DECIMAL(12,2)) END AS V_STK_DAYS ' 
									+ 'FROM PDATA.WDWH_CAL_STK_MONTH_AC S INNER JOIN  '
									+ ' ( SELECT DISTINCT OSTORE_ID, M.RESPON_NO ' 
									+ '   FROM PMART.LAST_ORG_DIM M ' 
									+ '  WHERE M.BRANCH_NO ='''+ I_ORG_ID +''' '
									+ ') B ON S.OSTORE_NO=B.OSTORE_ID  ' 
									+ 'WHERE S.YYYYMM >= '+ I_YYYYMM_S +' '
									+ 'AND S.YYYYMM <= '+ I_YYYYMM_E +' '
									+ 'AND S.KND_TYPE = '''+ I_KND_TYPE +''' '
									+ 'AND S.BRANCH_ID = '''+ I_ORG_ID +''' '
									+ 'GROUP BY S.YYYYMM,'
									+ 'S.PDEPT_ID, '
									+ 'S.DEPT_ID,'
									+ 'S.BRANCH_ID,'
									+ 'B.RESPON_NO,'
									+ 'S.KND_TYPE ';
	ELSEIF I_ORG_LEVEL = '1' AND I_STK_TYPE = '1' THEN
		SET V_SQLSTR =  'SELECT S.YYYYMM AS V_YYYYMM,'
									+ 'S.PDEPT_ID AS V_PDEPT_ID, '
									+ 'S.DEPT_ID AS V_DEPT_ID, '
									+ 'S.BRANCH_ID AS V_BRANCH_ID, '
									+ '''-1'' AS V_SREMP_NO, '
									+ 'CAST(-1 AS INTEGER) AS V_OST_NO, '
									+ 'S.KND_TYPE AS V_KND_TYPE, '
									+ 'CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2))) AS DECIMAL(12,2)) AS V_STK_AMT, ' 
									+ 'CASE WHEN SUM(S.WORKDAYS) = 0 THEN 0 ELSE (SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) END AS V_SALES_CNT_PSD,' 
									+ 'CASE WHEN SUM(S.SALES_AMT_SUM) = 0 THEN 0 ELSE CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2)))/(SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) AS DECIMAL(12,2)) END AS V_STK_DAYS ' 
									+ 'FROM PDATA.WDWH_CAL_STK_MONTH_AC S '
									+ 'WHERE S.YYYYMM >= '+ I_YYYYMM_S +' '
									+ 'AND S.YYYYMM <= '+ I_YYYYMM_E +' '
									+ 'AND S.KND_TYPE = '''+ I_KND_TYPE +''' '
									+ 'AND S.DEPT_ID = '''+ I_ORG_ID +''' '
									+ 'GROUP BY S.YYYYMM,'
									+ 'S.PDEPT_ID, '
									+ 'S.DEPT_ID,'
									+ 'S.BRANCH_ID,'
									+ 'S.KND_TYPE ';
	ELSEIF I_ORG_LEVEL = '0' AND I_STK_TYPE = '1' THEN
		SET V_SQLSTR =  'SELECT S.YYYYMM AS V_YYYYMM,'
									+ 'S.PDEPT_ID AS V_PDEPT_ID, '
									+ 'S.DEPT_ID AS V_DEPT_ID, '
									+ '''-1'' AS V_BRANCH_ID, '
									+ '''-1'' AS V_SREMP_NO, '
									+ 'CAST(-1 AS INTEGER) AS V_OST_NO, '
									+ 'S.KND_TYPE AS V_KND_TYPE, '
									+ 'CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2))) AS DECIMAL(12,2)) AS V_STK_AMT, ' 
									+ 'CASE WHEN SUM(S.WORKDAYS) = 0 THEN 0 ELSE (SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) END AS V_SALES_CNT_PSD,' 
									+ 'CASE WHEN SUM(S.SALES_AMT_SUM) = 0 THEN 0 ELSE CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2)))/(SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) AS DECIMAL(12,2)) END AS V_STK_DAYS ' 
									+ 'FROM PDATA.WDWH_CAL_STK_MONTH_AC S '
									+ 'WHERE S.YYYYMM >= '+ I_YYYYMM_S +' '
									+ 'AND S.YYYYMM <= '+ I_YYYYMM_E +' '
									+ 'AND S.KND_TYPE = '''+ I_KND_TYPE +''' '
									+ 'GROUP BY S.YYYYMM,'
									+ 'S.PDEPT_ID, '
									+ 'S.DEPT_ID, '
									+ 'S.KND_TYPE ';
	ELSEIF I_ORG_LEVEL = '-1' AND I_STK_TYPE = '1' THEN
		SET V_SQLSTR =  'SELECT S.YYYYMM AS V_YYYYMM,'
									+ 'S.PDEPT_ID AS V_PDEPT_ID, '
									+ '''-1'' AS V_DEPT_ID, '
									+ '''-1'' AS V_BRANCH_ID, '
									+ '''-1'' AS V_SREMP_NO, '
									+ 'CAST(-1 AS INTEGER) AS V_OST_NO, '
									+ 'S.KND_TYPE AS V_KND_TYPE, '
									+ 'CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2))) AS DECIMAL(12,2)) AS V_STK_AMT, ' 
									+ 'CASE WHEN SUM(S.WORKDAYS) = 0 THEN 0 ELSE (SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) END AS V_SALES_CNT_PSD,' 
									+ 'CASE WHEN SUM(S.SALES_AMT_SUM) = 0 THEN 0 ELSE CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2)))/(SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) AS DECIMAL(12,2)) END AS V_STK_DAYS '
									+ 'FROM PDATA.WDWH_CAL_STK_MONTH_AC S '
									+ 'WHERE S.YYYYMM >= '+ I_YYYYMM_S +' '
									+ 'AND S.YYYYMM <= '+ I_YYYYMM_E +' '
									+ 'AND S.KND_TYPE = '''+ I_KND_TYPE +''' '
									+ 'GROUP BY S.YYYYMM,'
									+ 'S.PDEPT_ID, '
									+ 'S.KND_TYPE ';
	ELSEIF I_ORG_LEVEL = '-2' AND I_STK_TYPE = '1' THEN
		SET V_SQLSTR =  'SELECT S.YYYYMM AS V_YYYYMM,'
									+ '''-1'' AS V_PDEPT_ID, '
									+ '''-1'' AS V_DEPT_ID, '
									+ '''-1'' AS V_BRANCH_ID, '
									+ '''-1'' AS V_SREMP_NO, '
									+ 'CAST(-1 AS INTEGER) AS V_OST_NO, '
									+ 'S.KND_TYPE AS V_KND_TYPE, '
									+ 'CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2))) AS DECIMAL(12,2)) AS V_STK_AMT, ' 
									+ 'CASE WHEN SUM(S.WORKDAYS) = 0 THEN 0 ELSE (SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) END AS V_SALES_CNT_PSD,' 
									+ 'CASE WHEN SUM(S.SALES_AMT_SUM) = 0 THEN 0 ELSE CAST(AVG(CAST(S.STK_AMT AS DECIMAL(12,2)))/(SUM(CAST(S.SALES_AMT_SUM AS DECIMAL(12,2))) / SUM(S.WORKDAYS)) AS DECIMAL(12,2)) END AS V_STK_DAYS ' 
									+ 'FROM PDATA.WDWH_CAL_STK_MONTH_AC S '
									+ 'WHERE S.YYYYMM >= '+ I_YYYYMM_S +' '
									+ 'AND S.YYYYMM <= '+ I_YYYYMM_E +' '
									+ 'AND S.KND_TYPE = '''+ I_KND_TYPE +''' '
									+ 'GROUP BY S.YYYYMM,'
									+ 'S.KND_TYPE ';
	END IF;
	SET SQLSTR = 'CREATE MULTISET VOLATILE TABLE #VT_WDWH_2_4_1_1_FUNC  AS( ' 
						+ V_SQLSTR
						+ ' ) WITH DATA PRIMARY INDEX (V_YYYYMM) ON COMMIT PRESERVE ROWS;'; 
	EXECUTE IMMEDIATE SQLSTR;  
END SP;