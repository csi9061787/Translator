REPLACE PROCEDURE PMART.REMD_SCAL_ACR(P_DAY_ID NUMBER)
SQL SECURITY INVOKER
SP:BEGIN
DECLARE SQLSTR  VARCHAR(4000) DEFAULT ''; 
  CALL PMART.P_DROP_TABLE ('#VT_REMD_SCAL_ACR'); 
      SET SQLSTR = 
          'CREATE MULTISET VOLATILE TABLE #VT_REMD_SCAL_ACR AS('+            
                'SELECT ((SUM(ACCU_AMT) / SUM((DECODE(ACCU_PLAN_STNUM,0,NULL,ACCU_PLAN_STNUM) * DECODE(BUDGET_DEPT_AVG_AMT,0,NULL,BUDGET_DEPT_AVG_AMT)))) * 0.9561 * 100) AS AMT '+
	        ' FROM ( '+              
	        ' SELECT '+
	        '  CAST(A.ACCU_AMT AS NUMBER) AS ACCU_AMT '+
	        ' ,CAST(A.ACCU_PLAN_STNUM AS NUMBER) AS ACCU_PLAN_STNUM '+
	        ' ,CAST(A.BUDGET_DEPT_AVG_AMT AS NUMBER) AS BUDGET_DEPT_AVG_AMT '+
	        ' FROM PMART.REMD_FACT_SUM A '+
                ' WHERE L_DAY_ID = '+P_DAY_ID+' '+
                ' AND ORG_ID IN (SELECT DISTINCT DEPT_ID FROM PMART.LAST_ORG_DIM) '+
                '      ) B '+
          ') WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;';
    EXECUTE IMMEDIATE SQLSTR; 
END SP;