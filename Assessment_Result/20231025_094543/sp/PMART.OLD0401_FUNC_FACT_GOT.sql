REPLACE PROCEDURE PMART.OLD0401_FUNC_FACT_GOT
(
   IN P_TIMEID VARCHAR(1000),
   IN P_ORGID VARCHAR(20),
   IN P_PRDID VARCHAR(20),
   IN P_ESHOP VARCHAR(20)
)
SP:BEGIN
   DECLARE SQLSTR  VARCHAR(20000);
   DECLARE ORGWHERE VARCHAR(2000);
   DECLARE PRDWHERE VARCHAR(50);
   DECLARE BASETABLE VARCHAR(50);
   SET ORGWHERE = 'AND ORG_ID = '+ TRIM(P_ORGID);
   SET PRDWHERE = 'AND PAS_PRD_ID = ' + TRIM(P_PRDID);      
   SET BASETABLE = 'PMART.FACT_MEMBER_PAS_GOT ';
   CALL PMART.P_DROP_TABLE ('#VT_FACT_GOT');
   SET SQLSTR = ' CREATE MULTISET VOLATILE TABLE #VT_FACT_GOT AS( '
						 + 'SELECT GOT_TIME_ID, PAS_PRD_ID, ORG_ID, ESHOP, '
                         + 'SUM(CURRENTDAY_MEMBER) AS CURRENTDAY_MEMBER, ' 
						 + 'SUM(CURRENTDAY_QTY) AS CURRENTDAY_QTY, ' 
                         + 'SUM(ONEDAY_MEMBER) AS ONEDAY_MEMBER, '
						 + 'SUM(ONEDAY_QTY) AS ONEDAY_QTY, ' 
                         + 'SUM(TWODAY_MEMBER) AS TWODAY_MEMBER, '
						 + 'SUM(TWODAY_QTY) AS TWODAY_QTY, ' 
                         + 'SUM(THREEDAY_MEMBER) AS THREEDAY_MEMBER, '
						 + 'SUM(THREEDAY_QTY) AS THREEDAY_QTY, '
						 + 'SUM(FOURDAY_MEMBER) AS FOURDAY_MEMBER, '
						 + 'SUM(FOURDAY_QTY) AS FOURDAY_QTY, '
						 + 'SUM(FIVEDAY_MEMBER) AS FIVEDAY_MEMBER, '
						 + 'SUM(FIVEDAY_QTY) AS FIVEDAY_QTY, ' 
						 + 'SUM(SIXDAY_MEMBER) AS SIXDAY_MEMBER, '
						 + 'SUM(SIXDAY_QTY) AS SIXDAY_QTY, '
						 + 'SUM(SEVENDAY_MEMBER) AS SEVENDAY_MEMBER, '
						 + 'SUM(SEVENDAY_QTY) AS SEVENDAY_QTY, '
						 + 'SUM(NOGOT_MEMBER) AS NOGOT_MEMBER, '
						 + 'SUM(NOGOT_QTY) AS NOGOT_QTY '
						 + 'FROM ' + BASETABLE
						 + 'WHERE  1= 1 '
						 + 'AND GOT_TIME_ID  IN (' + P_TIMEID +') '
						 + ORGWHERE
						 + PRDWHERE
						 + 'AND ESHOP IN ('+P_ESHOP+') '
						 + 'GROUP BY GOT_TIME_ID ,PAS_PRD_ID,ORG_ID,ESHOP'
						 + ' ) WITH DATA PRIMARY INDEX(GOT_TIME_ID,PAS_PRD_ID,ORG_ID,ESHOP) ON COMMIT PRESERVE ROWS;';	
	EXECUTE IMMEDIATE SQLSTR;  
END SP;