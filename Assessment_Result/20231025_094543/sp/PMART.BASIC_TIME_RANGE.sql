REPLACE PROCEDURE PMART.BASIC_TIME_RANGE(FP_TIME_TYPE CHAR(1)  CASESPECIFIC ,FP_TIME_ID NUMBER)
SQL SECURITY INVOKER
SP:BEGIN
DECLARE V_START_DAY NUMBER;
DECLARE V_END_DAY NUMBER;
DECLARE V_TIME_SERIAL NUMBER;  
CALL PMART.P_DROP_TABLE ('#VT_BASIC_TIME_RANGE');
   CASE  FP_TIME_TYPE
      WHEN 'D' THEN 
           SELECT DISTINCT L_WEEK_SERIAL INTO V_TIME_SERIAL FROM
           PMART.YMWD_TIME WHERE L_WEEK_ID=FP_TIME_ID;
           CREATE MULTISET VOLATILE TABLE #VT_BASIC_TIME_RANGE AS(
             SELECT MIN(L_DAY_ID) AS START_DAY,
             MAX(L_DAY_ID) AS END_DAY
             FROM PMART.YMWD_TIME 
             WHERE L_WEEK_SERIAL>=V_TIME_SERIAL-1 
             AND L_WEEK_SERIAL<=V_TIME_SERIAL
          ) WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;
      WHEN 'D' THEN 
           CREATE MULTISET VOLATILE TABLE #VT_BASIC_TIME_RANGE AS(
             SELECT MIN(L_DAY_ID) AS START_DAY,
             MAX(L_DAY_ID) END_DAY
             FROM PMART.YMWD_TIME WHERE L_WEEK_ID=FP_TIME_ID
          ) WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;      
      WHEN 'W' THEN 
           SELECT DISTINCT L_WEEK_SERIAL INTO V_TIME_SERIAL FROM
            PMART.YMWD_TIME WHERE L_WEEK_ID=FP_TIME_ID;
           CREATE MULTISET VOLATILE TABLE #VT_BASIC_TIME_RANGE AS(
             SELECT MIN(L_DAY_ID) AS START_DAY,
             MAX(L_DAY_ID) AS END_DAY
             FROM PMART.YMWD_TIME 
             WHERE L_WEEK_SERIAL>V_TIME_SERIAL-6 
             AND L_WEEK_SERIAL<=V_TIME_SERIAL
          ) WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;    
      WHEN 'M' THEN 
         SELECT DISTINCT L_MONTH_SERIAL INTO V_TIME_SERIAL FROM
            PMART.YMWD_TIME WHERE L_MONTH_ID=FP_TIME_ID;
          CREATE MULTISET VOLATILE TABLE #VT_BASIC_TIME_RANGE AS(
             SELECT MIN(L_DAY_ID) AS START_DAY,
             MAX(L_DAY_ID) AS END_DAY
             FROM PMART.YMWD_TIME 
             WHERE L_MONTH_SERIAL>V_TIME_SERIAL-6 
             AND L_MONTH_SERIAL<=V_TIME_SERIAL
          ) WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;    
   END CASE;
END SP;