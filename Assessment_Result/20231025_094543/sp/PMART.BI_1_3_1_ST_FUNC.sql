REPLACE PROCEDURE PMART.BI_1_3_1_ST_FUNC(P_LEVEL NUMBER,P_ORG_ID NUMBER)
SQL SECURITY INVOKER
SP:BEGIN
   DECLARE SQLSTR VARCHAR(1000);
   DECLARE ORG_STR VARCHAR(400);
   CALL PMART.P_DROP_TABLE ('#VT_BI_1_3_1_ST_FUNC');          
   IF (P_LEVEL=-1) THEN  
      SET ORG_STR = ' AND L.TOT_ID= -1 ';
   END IF;
   IF (P_LEVEL=0) THEN  
      SET ORG_STR = ' AND L.PDEPT_ID= '+P_ORG_ID;
   END IF;
   IF (P_LEVEL=1) THEN  
      SET ORG_STR = ' AND L.DEPT_ID= '+P_ORG_ID;
   END IF;
   IF (P_LEVEL=2) THEN  
      SET ORG_STR = ' AND L.BRANCH_ID= '+ P_ORG_ID;	  
   END IF;
   SET SQLSTR ='CREATE MULTISET VOLATILE TABLE #VT_BI_1_3_1_ST_FUNC  AS('+
      'SELECT L.STORE_ID,L.STORE_NM,T.MMA_NM,L.PDEPT_ID,L.PDEPT_NM,L.DEPT_ID,L.DEPT_NM,L.BRANCH_ID,L.BRANCH_NM,L.RESPON_ID,L.RESPON_NM '+
      'FROM PMART.LAST_ORG_DIM L, PMART.ORG_TYPE_DIM T '+
      'WHERE L.STORE_ID = T.STORE_ID ' + ORG_STR +      
      ') WITH DATA PRIMARY INDEX (STORE_ID) ON COMMIT PRESERVE ROWS;'; 
	EXECUTE IMMEDIATE SQLSTR;
END SP;