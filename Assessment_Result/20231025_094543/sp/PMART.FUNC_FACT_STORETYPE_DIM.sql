REPLACE PROCEDURE PMART.FUNC_FACT_STORETYPE_DIM
(
   IN P_SHOWTYPE INTEGER,  
   IN P_STORETYPE VARCHAR(1)
)
SP:BEGIN
    DECLARE SQLSTR  VARCHAR(2000) ;
    CALL PMART.P_DROP_TABLE ('#VT_FUNC_FACT_STORETYPE_DIM');
    SET SQLSTR = 'CREATE MULTISET VOLATILE TABLE #VT_FUNC_FACT_STORETYPE_DIM ( '
						 +'STTP_ID VARCHAR(2), '
	                     +'STTP_NAME VARCHAR(20)  , '
						 +'STTP_SEQ SMALLINT '
	                     +') UNIQUE PRIMARY INDEX(STTP_SEQ) ON COMMIT PRESERVE ROWS; ';
    EXECUTE IMMEDIATE SQLSTR;   
    IF P_SHOWTYPE = 2 THEN 
		SET SQLSTR = 'INSERT INTO #VT_FUNC_FACT_STORETYPE_DIM(STTP_SEQ,STTP_ID,STTP_NAME) VALUES(0,CAST('''+ '-1' + ''' AS VARCHAR(2)),CAST('''+'合計'+'''  AS VARCHAR(20))); ';
	ELSE 
	    SET SQLSTR = 'INSERT INTO #VT_FUNC_FACT_STORETYPE_DIM(STTP_SEQ,STTP_ID,STTP_NAME) VALUES(0,CAST('''+ '-1' + ''' AS VARCHAR(2)),CAST('''+'
    END IF;	
	EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR =' INSERT INTO #VT_FUNC_FACT_STORETYPE_DIM(STTP_SEQ,STTP_ID,STTP_NAME)  '
                         +'   SELECT ROW_NUMBER() OVER(ORDER BY STTP_SNAME) AS STTP_SEQ,STORE_TYPE AS STTP_ID,STTP_SNAME AS STTP_NAME '
                         +'      FROM PDATA.PBMSTTP  T '
						 +'   WHERE EXISTS (SELECT 1 FROM PMART.LAST_ORG_STORE S WHERE T.STORE_TYPE = S.STORE_TYPE AND S.CLOSE_DATE = CAST(''9999-12-31'' AS DATE)) ';
	IF TRIM(P_STORETYPE)<>'' THEN 
	    SET SQLSTR = SQLSTR + ' AND STORE_TYPE =''' + P_STORETYPE+'''';
	END IF;
    EXECUTE IMMEDIATE SQLSTR;   
END SP;