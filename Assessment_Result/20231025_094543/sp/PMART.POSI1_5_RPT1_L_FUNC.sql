REPLACE PROCEDURE PMART.POSI1_5_RPT1_L_FUNC (P_L_DAY_ID VARCHAR(400),P_RPT VARCHAR(400),P_UNIT VARCHAR(400))
SQL SECURITY INVOKER
SP:BEGIN
   DECLARE SQLSTR  VARCHAR(8000); 
   DECLARE V_SELECT  VARCHAR(4000); 
   CALL PMART.P_DROP_TABLE ('#VT_POSI1_5_RPT1_L_FUNC');   
   SET SQLSTR ='CREATE MULTISET VOLATILE TABLE #VT_POSI1_5_RPT1_L_FUNC  
                (TIME_ID NUMBER, PRD_ID NUMBER,RESPON_ID NUMBER,L_REAL_SALES_PSD NUMBER,L_INPRD_RATE NUMBER,L_REAL_SALES_AMT NUMBER
                ) NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;';
   EXECUTE IMMEDIATE SQLSTR;        
   IF (P_RPT='RPT1_1' AND P_UNIT='GRP' ) THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        '  SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        '  T.PRD_ID AS PRD_ID, '+
        '  0, '+
        '  CASE WHEN (T.UPLOAD_STNUM) > 0 THEN (T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/(T.UPLOAD_STNUM) ELSE 0 END , '+       
        '  CASE WHEN (T.SL2_0103R) > 0 THEN (T.SL2_0103R-T.CS_0103R)/(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        '  (T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+        
        '  FROM PMART.BASIC_MFACT_BUDGET T '+  
        ' WHERE T.TIME_ID = TO_NUMBER(TO_CHAR(DateAdd(MONTH,''YYYYMM''),TO_DATE('''+ P_L_DAY_ID +'''),''YYYYMM'')) ';
   END IF;
   IF (P_RPT='RPT1_3' AND P_UNIT='GRP' ) THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        '  SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        '  T.PRD_ID AS PRD_ID, '+
        '  A.RESPON_ID AS RESPON_ID, '+
        '  CASE WHEN (T.UPLOAD_STNUM) > 0 THEN (T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+
        '  CASE WHEN (T.SL2_0103R) > 0 THEN (T.SL2_0103R-T.CS_0103R)/(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        '  (T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+
        '  FROM (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) A LEFT OUTER JOIN PMART.BASIC_MFACT_BUDGET T ON (T.PRD_ID=A.GRP_ID)  '+
        ' WHERE T.TIME_ID = TO_NUMBER(TO_CHAR(DateAdd(MONTH,''YYYYMM''),TO_DATE('''+ P_L_DAY_ID +'''),''YYYYMM'')) ';
   END IF;
   IF (P_RPT='RPT2_1' AND P_UNIT='GRP' ) THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        '  SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        '  T.PRD_ID AS PRD_ID, '+
        '  0, '+
        '  CASE WHEN (T.UPLOAD_STNUM) > 0 THEN (T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+
        '  CASE WHEN (T.SL2_0103R) > 0 THEN (T.SL2_0103R-T.CS_0103R)/(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        '  (T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+
        '  FROM PMART.BASIC_MFACT_BUDGET T '+
        ' WHERE T.TIME_ID = TO_NUMBER('''+ P_L_DAY_ID +''') -1 '; 
   END IF;
   IF (P_RPT='RPT2_3' AND P_UNIT='GRP' ) THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        '  SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        '  T.PRD_ID AS PRD_ID, '+
        '  A.RESPON_ID AS RESPON_ID, '+
        '  CASE WHEN (T.UPLOAD_STNUM) > 0 THEN (T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+
        '  CASE WHEN (T.SL2_0103R) > 0 THEN (T.SL2_0103R-T.CS_0103R)/(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        '  (T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+
        '  FROM (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) A LEFT OUTER JOIN PMART.BASIC_MFACT_BUDGET T ON (T.PRD_ID=A.GRP_ID)  '+
        ' WHERE T.TIME_ID = TO_NUMBER('''+ P_L_DAY_ID +''') -1 '; 
   END IF;
   IF (P_RPT='RPT1_1' AND P_UNIT='KND' ) THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        '  SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        '  A.KND_ID AS PRD_ID, '+
        '  0, '+
        '  CASE WHEN MAX(T.UPLOAD_STNUM) > 0 THEN SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/MAX(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+
        '  CASE WHEN SUM(T.SL2_0103R) > 0 THEN SUM(T.SL2_0103R-T.CS_0103R)/SUM(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        '  SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+
        '  FROM PMART.BASIC_MFACT_BUDGET T INNER JOIN (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1)  A '+
        '    ON T.PRD_ID = A.GRP_ID '+
        ' WHERE T.TIME_ID = TO_NUMBER(TO_CHAR(DateAdd(MONTH,''YYYYMM''),TO_DATE('''+ P_L_DAY_ID +'''),''YYYYMM'')) '+        
        ' GROUP BY T.TIME_ID,A.KND_ID ';
   END IF;
   IF (P_RPT='RPT1_2' AND P_UNIT='KND' ) THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        '  SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        '  A.KND_ID AS PRD_ID, '+
        '  A.RESPON_ID AS RESPON_ID, '+
        '  CASE WHEN MAX(T.UPLOAD_STNUM) > 0 THEN SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/MAX(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+
        '  CASE WHEN SUM(T.SL2_0103R) > 0 THEN SUM(T.SL2_0103R-T.CS_0103R)/SUM(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        '  SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+
        '  FROM PMART.BASIC_MFACT_BUDGET T INNER JOIN (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) A '+
        '    ON T.PRD_ID = A.GRP_ID '+
        ' WHERE T.TIME_ID = TO_NUMBER(TO_CHAR(DateAdd(MONTH,''YYYYMM''),TO_DATE('''+ P_L_DAY_ID +'''),''YYYYMM'')) '+        
        ' GROUP BY T.TIME_ID,A.RESPON_ID,A.KND_ID ';
   END IF;
   IF (P_RPT='RPT2_1' AND P_UNIT='KND' ) THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        '  SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        '  A.KND_ID AS PRD_ID, '+
        '  0, '+
        '  CASE WHEN MAX(T.UPLOAD_STNUM) > 0 THEN SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/MAX(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+
        '  CASE WHEN SUM(T.SL2_0103R) > 0 THEN SUM(T.SL2_0103R-T.CS_0103R)/SUM(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        '  SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+
        '  FROM PMART.BASIC_MFACT_BUDGET T INNER JOIN  (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) A '+
        '    ON T.PRD_ID = A.GRP_ID '+
        ' WHERE T.TIME_ID = TO_NUMBER('''+ P_L_DAY_ID +''') -1 ' +      
        ' GROUP BY T.TIME_ID,A.KND_ID ';
   END IF;
   IF (P_RPT='RPT2_2' AND P_UNIT='KND' ) THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        '  SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        '  A.KND_ID AS PRD_ID, '+
        '  A.RESPON_ID AS RESPON_ID, '+
        '  CASE WHEN MAX(T.UPLOAD_STNUM) > 0 THEN SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/MAX(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+
        '  CASE WHEN SUM(T.SL2_0103R) > 0 THEN SUM(T.SL2_0103R-T.CS_0103R)/SUM(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        '  SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+      
        '  FROM PMART.BASIC_MFACT_BUDGET T INNER JOIN  (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) A '+
        '    ON T.PRD_ID = A.GRP_ID '+
        ' WHERE T.TIME_ID = TO_NUMBER('''+ P_L_DAY_ID +''')-1 ' +
        ' GROUP BY T.TIME_ID,A.RESPON_ID,A.KND_ID '; 
   END IF;
   IF (P_RPT='RPT1_1' AND P_UNIT='RESPON') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        ' SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        ' B.RESPON_ID AS PRD_ID, '+
        ' 0, '+
        ' CASE WHEN MAX(T.UPLOAD_STNUM) > 0 THEN SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/MAX(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+
        ' CASE WHEN SUM(T.SL2_0103R) > 0 THEN SUM(T.SL2_0103R-T.CS_0103R)/SUM(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        ' SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+
        ' FROM PMART.BASIC_MFACT_BUDGET T  INNER JOIN  (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
        '   ON T.PRD_ID = B.GRP_ID '+
        ' WHERE T.TIME_ID = TO_NUMBER(TO_CHAR(DateAdd(MONTH,''YYYYMM''),TO_DATE('''+ P_L_DAY_ID +'''),''YYYYMM'')) '+        
        ' GROUP BY T.TIME_ID,B.RESPON_ID ';
   END IF;
   IF (P_RPT='RPT2_1' AND P_UNIT='RESPON') THEN
      SET  SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        '  SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        '  B.RESPON_ID AS PRD_ID, '+
        '  0, '+
        '  CASE WHEN MAX(T.UPLOAD_STNUM) > 0 THEN SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/MAX(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+
        '  CASE WHEN SUM(T.SL2_0103R) > 0 THEN SUM(T.SL2_0103R-T.CS_0103R)/SUM(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        '  SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+
        '  FROM PMART.BASIC_MFACT_BUDGET T INNER JOIN  (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
        '    ON T.PRD_ID = B.GRP_ID '+
        ' WHERE T.TIME_ID = TO_NUMBER('''+ P_L_DAY_ID +''')-1 ' +        
        ' GROUP BY T.TIME_ID,B.RESPON_ID '; 
   END IF;
   IF (P_RPT='RPT1_1' AND P_UNIT='BIGKND') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        '  SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        '  B.PRD_ID AS PRD_ID, '+
        '  0, '+
        '  CASE WHEN MAX(T.UPLOAD_STNUM) > 0 THEN SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/MAX(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+
        '  CASE WHEN SUM(T.SL2_0103R) > 0 THEN SUM(T.SL2_0103R-T.CS_0103R)/SUM(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        '  SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+
        '  FROM PMART.BASIC_MFACT_BUDGET T INNER JOIN  (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) A '+
        '    ON T.PRD_ID = A.GRP_ID '+        
        '                                  INNER JOIN   PMART.PRD_DIM_POSI1 B '+
        '    ON A.KND_ID = B.KND_ID '+
        ' WHERE T.TIME_ID = TO_NUMBER(TO_CHAR(DateAdd(MONTH,''YYYYMM''),TO_DATE('''+ P_L_DAY_ID +'''),''YYYYMM'')) '+
        ' GROUP BY T.TIME_ID,B.PRD_ID ';
   END IF;
   IF (P_RPT='RPT2_1' AND P_UNIT='BIGKND') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        '  SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        '  B.PRD_ID AS PRD_ID, '+
        '  0, '+
        '  CASE WHEN MAX(T.UPLOAD_STNUM) > 0 THEN SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/MAX(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+
        '  CASE WHEN SUM(T.SL2_0103R) > 0 THEN SUM(T.SL2_0103R-T.CS_0103R)/SUM(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        '  SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+      
        '  FROM PMART.BASIC_MFACT_BUDGET T INNER JOIN  (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) A '+
        '    ON T.PRD_ID = A.GRP_ID '+                
        '                                  INNER JOIN   PMART.PRD_DIM_POSI1 B '+
        '    ON A.KND_ID = B.KND_ID '+
        ' WHERE T.TIME_ID = TO_NUMBER('''+ P_L_DAY_ID +''')-1 ' +
        ' GROUP BY T.TIME_ID,B.PRD_ID '; 
   END IF;
   IF (P_RPT='RPT1_1' AND P_UNIT='BRANCH') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        '  SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        '  B.BRANCH_ID AS PRD_ID, '+
        '  0, '+
        '  CASE WHEN MAX(T.UPLOAD_STNUM) > 0 THEN SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/MAX(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+
        '  CASE WHEN SUM(T.SL2_0103R) > 0 THEN SUM(T.SL2_0103R-T.CS_0103R)/SUM(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        '  SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+
        '  FROM PMART.BASIC_MFACT_BUDGET T INNER JOIN  (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
        '    ON T.PRD_ID = B.GRP_ID '+
        ' WHERE T.TIME_ID = TO_NUMBER(TO_CHAR(DateAdd(MONTH,''YYYYMM''),TO_DATE('''+ P_L_DAY_ID +'''),''YYYYMM'')) '+        
        ' GROUP BY T.TIME_ID,B.BRANCH_ID '; 
   END IF;
   IF (P_RPT='RPT2_1' AND P_UNIT='BRANCH') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        '  SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        '  B.BRANCH_ID AS PRD_ID, '+
        '  0, '+
        '  CASE WHEN MAX(T.UPLOAD_STNUM) > 0 THEN SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/MAX(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+
        '  CASE WHEN SUM(T.SL2_0103R) > 0 THEN SUM(T.SL2_0103R-T.CS_0103R)/SUM(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        '  SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+
        '  FROM PMART.BASIC_MFACT_BUDGET T INNER JOIN  (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
        '    ON T.PRD_ID = B.GRP_ID '+
        ' WHERE T.TIME_ID = TO_NUMBER('''+ P_L_DAY_ID +''')-1 ' +        
        ' GROUP BY T.TIME_ID,B.BRANCH_ID '; 
   END IF;
   IF (P_RPT='RPT1_1' AND P_UNIT='DEPT') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        '  SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        '  B.DEPT_ID AS PRD_ID, '+
        '  0, '+
        '  CASE WHEN MAX(T.UPLOAD_STNUM) > 0 THEN SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/MAX(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+
        '  CASE WHEN SUM(T.SL2_0103R) > 0 THEN SUM(T.SL2_0103R-T.CS_0103R)/SUM(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        '  SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+
        '  FROM PMART.BASIC_MFACT_BUDGET T INNER JOIN  (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
        '    ON T.PRD_ID = B.GRP_ID '+
        ' WHERE T.TIME_ID = TO_NUMBER(TO_CHAR(DateAdd(MONTH,''YYYYMM''),TO_DATE('''+ P_L_DAY_ID +'''),''YYYYMM'')) '+
        ' GROUP BY T.TIME_ID,B.DEPT_ID ';
   END IF;
   IF (P_RPT='RPT2_1' AND P_UNIT='DEPT') THEN
      SET  SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        '  SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        '  B.DEPT_ID AS PRD_ID, '+
        '  0, '+
        '  CASE WHEN MAX(T.UPLOAD_STNUM) > 0 THEN SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/MAX(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+
        '  CASE WHEN SUM(T.SL2_0103R) > 0 THEN SUM(T.SL2_0103R-T.CS_0103R)/SUM(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        '  SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+
        '  FROM PMART.BASIC_MFACT_BUDGET T INNER JOIN  (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
        '    ON T.PRD_ID = B.GRP_ID '+
        ' WHERE T.TIME_ID = TO_NUMBER('''+ P_L_DAY_ID +''')-1 ' +
        ' GROUP BY T.TIME_ID,B.DEPT_ID ';
   END IF;
    IF (P_RPT='RPT1_1' AND P_UNIT='TOT') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        '  SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        '  B.TOT_ID AS PRD_ID, '+
        '  0, '+
        '  CASE WHEN MAX(T.UPLOAD_STNUM) > 0 THEN SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/MAX(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+      
        '  CASE WHEN SUM(T.SL2_0103R) > 0 THEN SUM(T.SL2_0103R-T.CS_0103R)/SUM(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        '  SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+      
        '  FROM PMART.BASIC_MFACT_BUDGET T INNER JOIN  (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
        '    ON T.PRD_ID = B.GRP_ID '+
        ' WHERE T.TIME_ID = TO_NUMBER(TO_CHAR(DateAdd(MONTH,''YYYYMM''),TO_DATE('''+ P_L_DAY_ID +'''),''YYYYMM'')) '+
        ' GROUP BY T.TIME_ID,B.TOT_ID ';
   END IF;
   IF (P_RPT='RPT2_1' AND P_UNIT='TOT') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        '  SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        '  B.TOT_ID AS PRD_ID, '+
        '  0, '+
        '  CASE WHEN MAX(T.UPLOAD_STNUM) > 0 THEN SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/MAX(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+
        '  CASE WHEN SUM(T.SL2_0103R) > 0 THEN SUM(T.SL2_0103R-T.CS_0103R)/SUM(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        '  SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+
        '  FROM PMART.BASIC_MFACT_BUDGET T INNER JOIN  (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
        '    ON T.PRD_ID = B.GRP_ID '+
        ' WHERE T.TIME_ID = TO_NUMBER('''+ P_L_DAY_ID +''')-1 ' +
        ' GROUP BY T.TIME_ID,B.TOT_ID ';
   END IF;
   IF (P_RPT='RPT1_1' AND P_UNIT='ALL') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        '  SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        '  -99 AS PRD_ID, '+
        '  0, '+
        '  CASE WHEN MAX(T.UPLOAD_STNUM) > 0 THEN SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/MAX(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+      
        '  CASE WHEN SUM(T.SL2_0103R) > 0 THEN SUM(T.SL2_0103R-T.CS_0103R)/SUM(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        '  SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+      
        '  FROM PMART.BASIC_MFACT_BUDGET T INNER JOIN  (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
        '    ON T.PRD_ID = B.GRP_ID '+
        ' WHERE T.TIME_ID = TO_NUMBER(TO_CHAR(DateAdd(MONTH,''YYYYMM''),TO_DATE('''+ P_L_DAY_ID +'''),''YYYYMM'')) '+
        ' GROUP BY T.TIME_ID ';
   END IF;
   IF (P_RPT='RPT2_1' AND P_UNIT='ALL') THEN
      SET SQLSTR ='INSERT INTO #VT_POSI1_5_RPT1_L_FUNC(TIME_ID,PRD_ID,RESPON_ID,L_REAL_SALES_PSD ,L_INPRD_RATE ,L_REAL_SALES_AMT)'+
        '  SELECT '+ P_L_DAY_ID +' AS TIME_ID, '+
        '  -99 AS PRD_ID, '+
        '  0, '+
        '  CASE WHEN MAX(T.UPLOAD_STNUM) > 0 THEN SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT)/MAX(CAST(T.UPLOAD_STNUM AS DECIMAL(16,6))) ELSE 0 END , '+
        '  CASE WHEN SUM(T.SL2_0103R) > 0 THEN SUM(T.SL2_0103R-T.CS_0103R)/SUM(CAST(T.SL2_0103R AS DECIMAL(16,6)))*100 ELSE 0 END , '+
        '  SUM(T.SALES_AMT-T.DIS_AMT-T.SUB_AMT) '+
        '  FROM PMART.BASIC_MFACT_BUDGET T INNER JOIN  (SELECT * FROM PMART.ORG_DIM_POSI1 WHERE SEQNO=1) B '+
        '    ON T.PRD_ID = B.GRP_ID '+
        ' WHERE T.TIME_ID = TO_NUMBER('''+ P_L_DAY_ID +''')-1 ' +
        ' GROUP BY T.TIME_ID ';
   END IF;
	EXECUTE IMMEDIATE SQLSTR;
END SP;