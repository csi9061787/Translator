CREATE PROCEDURE PDATA.FUNC_PRDREL_RPT_SPC
(
	NOWSTR  VARCHAR(20)  
)
SQL SECURITY INVOKER
SP:BEGIN
DECLARE SQLSTR  VARCHAR(4000) DEFAULT ''; 
UPDATE PDATA.PRDREL_RPT_SPC 
SET LAST_JOB_ID= NULL
,USE_BDT = NULL
,USE_EDT = NULL
WHERE USE_EDT <  CAST(NOWSTR AS TIMESTAMP(0) FORMAT 'YYYY-MM-DDHH:MI:SS');
  CALL PMART.P_DROP_TABLE ('#VT_FUNC_PRDREL_RPT_SPC');
 SET SQLSTR = ' CREATE MULTISET VOLATILE TABLE #VT_FUNC_PRDREL_RPT_SPC AS('+   
						' SELECT CASE WHEN S.LAST_JOB_ID IS  NOT NULL THEN  ''N'' ELSE ''Y'' END  OPT ' +
						' ,S.SPACE_ID, S.SPACE_NAME, S.SPACE_URL, S.SPACE_PATH'+
						'  ,S.USE_LIMIT,S.LAST_JOB_ID,S.USE_BDT,S.USE_EDT,P.PARA_VAL1 AS CALFL_PATH ' +
						' FROM PDATA.PRDREL_RPT_SPC S ,' +
						' (SELECT P.PARA_NAME, P.PARA_VAL1 FROM PDATA.SYS_PARA P WHERE P.FUN_CLASS=''PRDREL'' AND P.PARA_TYPE=''CALFL_PATH'' AND P.PARA_ID=1 ) P '+
						') WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;';
  EXECUTE IMMEDIATE SQLSTR; 
END SP;