REPLACE PROCEDURE PMART.FUNC_FACT_STMARKETING_DIM_DOWNLOAD
(
   IN P_ACTID INTEGER
)
SP:BEGIN
    DECLARE SQLSTR  VARCHAR(2000) ;
    CALL PMART.P_DROP_TABLE ('#VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD');
    SET SQLSTR = 'CREATE MULTISET VOLATILE TABLE #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD ( '
	                     +'RAISE_ID INTEGER, '
						 +'ITEM_ID INTEGER, '
						 +'ITEM_COL VARCHAR(40), '
	                     +'ITEM_NAME VARCHAR(40)  , '
						 +'COL_TYPE VARCHAR(1)  '
	                     +') UNIQUE PRIMARY INDEX(ITEM_ID) ON COMMIT PRESERVE ROWS; ';
    EXECUTE IMMEDIATE SQLSTR;   
	SET SQLSTR = 'INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD SELECT 0,1000001,''DEPT_NO'',CAST('' ' +'部門代號' +' ''  AS VARCHAR(40)),CAST(''C'' AS VARCHAR(1)) AS COL_TYPE; ';
	EXECUTE IMMEDIATE SQLSTR;
    SET SQLSTR = 'INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD SELECT 0,1000002,''BRANCH_NO'',CAST('' ' +'課別代號' +' ''  AS VARCHAR(40)),CAST(''C'' AS VARCHAR(1)) AS COL_TYPE; ';
	EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR = 'INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD SELECT 0,1000003,''STORE_NO'',CAST('' ' +'店號' +' ''  AS VARCHAR(40)),CAST(''C'' AS VARCHAR(1)) AS COL_TYPE; ';
	EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR = 'INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD SELECT 0,1000004,''STORE_NAME'',CAST('' ' +'店名' +' ''  AS VARCHAR(40)),CAST(''C'' AS VARCHAR(1)) AS COL_TYPE; ';
	EXECUTE IMMEDIATE SQLSTR;
    SET SQLSTR = 'INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD SELECT 0,1000005,''L_TIME_NM'',CAST('' ' +'交易時間' +' ''  AS VARCHAR(40)),CAST(''C'' AS VARCHAR(1)) AS COL_TYPE; ';
	EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR = 'INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD SELECT 0,1000006,''SALE_AMT'',CAST('' ' +'銷售金額_排菸' +' ''  AS VARCHAR(40)),CAST(''N'' AS VARCHAR(1)) AS COL_TYPE; ';
	EXECUTE IMMEDIATE SQLSTR;
   SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD SELECT 0,1000007,''CIG_AMT'',CAST('' ' +'香菸銷售金額' +' ''  AS VARCHAR(40)),CAST(''N'' AS VARCHAR(1)) AS COL_TYPE; ';
	EXECUTE IMMEDIATE SQLSTR;
    SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD SELECT 0,1000008,''DIS_SUB_AMT'',CAST('' ' +'折扣讓金額' +' ''  AS VARCHAR(40)),CAST(''N'' AS VARCHAR(1)) AS COL_TYPE; ';
	EXECUTE IMMEDIATE SQLSTR;
    SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD SELECT 0,1000009,''TRAN_CNT'',CAST('' ' +'客數' +' ''  AS VARCHAR(40)),CAST(''N'' AS VARCHAR(1)) AS COL_TYPE; ';
	EXECUTE IMMEDIATE SQLSTR;
    SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD SELECT 0,1000010,''DAISO_AMT'',CAST('' ' +'代售金額' +' ''  AS VARCHAR(40)),CAST(''N'' AS VARCHAR(1)) AS COL_TYPE; ';
	EXECUTE IMMEDIATE SQLSTR;
    SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD SELECT 0,1000011,''DAIFU_AMT'',CAST('' ' +'代付金額' +' ''  AS VARCHAR(40)),CAST(''N'' AS VARCHAR(1)) AS COL_TYPE; ';
	EXECUTE IMMEDIATE SQLSTR;
    SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD SELECT 0,1000012,''MARKETING_TRAN_CNT'',CAST('' ' +'應發筆數' +' ''  AS VARCHAR(40)),CAST(''N'' AS VARCHAR(1)) AS COL_TYPE; ';
	EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD SELECT 0,1000013,''MARKETING_TOT_POINT'',CAST('' ' +'應發點數' +' ''  AS VARCHAR(40)),CAST(''N'' AS VARCHAR(1)) AS COL_TYPE; '; 
	EXECUTE IMMEDIATE SQLSTR;
    SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD SELECT 0,1000014,''MARKETING_POINT'',CAST('' ' +'滿額實發點數' +' ''  AS VARCHAR(40)),CAST(''N'' AS VARCHAR(1)) AS COL_TYPE; ';
	EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD SELECT 0,1000015,''MARKETING_CAL_POINT'',CAST('' ' +'總實發點數' +' ''  AS VARCHAR(40)),CAST(''N'' AS VARCHAR(1)) AS COL_TYPE; '; 
	EXECUTE IMMEDIATE SQLSTR;	
	SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD SELECT 0,1000016,''MARKETING_NOTRAN_POINT'',CAST('' ' +'應發未發點數' +' ''  AS VARCHAR(40)),CAST(''N'' AS VARCHAR(1)) AS COL_TYPE; '; 
	EXECUTE IMMEDIATE SQLSTR;		
    SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD SELECT 0,1000017,''MARKETING_POMO_POINT'',CAST('' ' +'加碼送_實發點數' +' ''  AS VARCHAR(40)),CAST(''N'' AS VARCHAR(1)) AS COL_TYPE; ';
	EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD SELECT 0,1000018,''PDEPT_NO'',CAST('' ' +'本部代號' +' ''  AS VARCHAR(40)),CAST(''C'' AS VARCHAR(1)) AS COL_TYPE; ';
	EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR = 'INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM_DOWNLOAD '
						 +'SELECT RAISE_ID,2 + TRIM(SUBSTRING('''+ CAST('000000' AS VARCHAR(6)) +''',1,6-LENGTH(TRIM(TO_CHAR(RAISE_ID)))))  +  TRIM(TO_CHAR(RAISE_ID)) ITEM_ID,''COL''+TRIM(TO_CHAR(RAISE_ID)) AS ITEM_COL,RAISE_NM ITEM_NAME,CAST(''N'' AS VARCHAR(1)) AS COL_TYPE '
	    	             +'   FROM PDATA.STORMKT_RAISE_M '
	                     +'WHERE ACT_ID = ' + P_ACTID + '; ';
    EXECUTE IMMEDIATE SQLSTR;   
END SP;