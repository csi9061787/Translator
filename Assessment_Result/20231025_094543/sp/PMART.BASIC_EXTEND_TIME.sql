REPLACE PROCEDURE PMART.BASIC_EXTEND_TIME                                         
(FP_TIME_TYPE CHAR(1) CASESPECIFIC,FP_TIME_LIST VARCHAR(2000) CASESPECIFIC,FP_ORG_ID NUMBER)
SQL SECURITY INVOKER
SP:BEGIN
DECLARE SQLSTR  VARCHAR(4000) DEFAULT ''; 
  CALL PMART.P_DROP_TABLE ('#VT_BASIC_EXTEND_TIME'); 
  CASE FP_TIME_TYPE
      WHEN 'D' THEN 
           SET SQLSTR = 
               'CREATE MULTISET VOLATILE TABLE #VT_BASIC_EXTEND_TIME  AS('+      
                        'SELECT DISTINCT L_DAY_ID AS TIME_ID,L_DAY_NAME AS TIME_NM,L_DAY_LAST_YEAR AS LTIME_ID, '+
                        ' (SELECT L_DAY_NAME FROM PMART.YMWD_TIME T2 WHERE T2.L_DAY_ID = T.L_DAY_LAST_YEAR) AS LTIME_NM, '+
                        ' 0 AS MAST_STORE_NUM,0 AS WEATHER,0 AS LWEATHER,NULL AS WEATH_NAME,NULL AS LWEATH_NAME '+
                        ' FROM PMART.YMWD_TIME T '+
                        ' WHERE L_DAY_ID IN ('+ FP_TIME_LIST +') '+
               ') WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;';
               	EXECUTE IMMEDIATE SQLSTR; 
      WHEN 'S' THEN 
           SET SQLSTR = 
               'CREATE MULTISET VOLATILE TABLE #VT_BASIC_EXTEND_TIME  AS('+      
                  'SELECT DISTINCT L_WEEK_ID AS TIME_ID,L_WEEK_NAME AS TIME_NM,L_WEEK_LAST_YEAR AS LTIME_ID, '+
                  ' (SELECT DISTINCT L_WEEK_NAME FROM PMART.YMWD_TIME T2 WHERE T2.L_WEEK_ID = T.L_WEEK_LAST_YEAR) AS LTIME_NM, '+
                  ' 0 AS MAST_STORE_NUM,0 AS WEATHER,0 AS LWEATHER,NULL AS WEATH_NAME,NULL AS LWEATH_NAME '+
                  ' FROM PMART.YMWD_TIME T '+
                  ' WHERE L_WEEK_ID IN ('+ FP_TIME_LIST +') '+
               ') WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;';
               	EXECUTE IMMEDIATE SQLSTR; 
      WHEN 'W' THEN 
           SET SQLSTR = 
               'CREATE MULTISET VOLATILE TABLE #VT_BASIC_EXTEND_TIME  AS('+      
                   'SELECT DISTINCT L_WEEK_ID AS TIME_ID,L_WEEK_NAME AS TIME_NM,L_WEEK_LAST_YEAR AS LTIME_ID, '+
                   ' (SELECT DISTINCT L_WEEK_NAME FROM PMART.YMWD_TIME T2 WHERE T2.L_WEEK_ID = T.L_WEEK_LAST_YEAR) AS LTIME_NM, '+
                   ' 0 AS MAST_STORE_NUM,0 AS WEATHER,0 AS LWEATHER,NULL AS WEATH_NAME,NULL AS LWEATH_NAME '+
                   ' FROM PMART.YMWD_TIME T '+
                   ' WHERE L_WEEK_ID IN ('+ FP_TIME_LIST +') '+
               ') WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;';
               	EXECUTE IMMEDIATE SQLSTR; 
      WHEN 'M' THEN 
           SET SQLSTR = 
               'CREATE MULTISET VOLATILE TABLE #VT_BASIC_EXTEND_TIME  AS('+      
                     'SELECT DISTINCT L_MONTH_ID AS TIME_ID,L_MONTH_NAME AS TIME_NM,L_MONTH_LAST_YEAR AS LTIME_ID, '+
                     ' (SELECT DISTINCT L_MONTH_NAME FROM PMART.YMWD_TIME T2 WHERE T2.L_MONTH_ID = T.L_MONTH_LAST_YEAR) AS LTIME_NM, '+
                     ' 0 AS MAST_STORE_NUM,0 AS WEATHER,0 AS LWEATHER,NULL AS WEATH_NAME,NULL AS LWEATH_NAME '+
                     ' FROM PMART.YMWD_TIME T '+
                     ' WHERE L_MONTH_ID IN ('+ FP_TIME_LIST +') '+          
               ') WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;';
               	EXECUTE IMMEDIATE SQLSTR; 
   END CASE;  
END SP;