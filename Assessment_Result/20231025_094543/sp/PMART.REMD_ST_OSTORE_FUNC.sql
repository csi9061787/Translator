REPLACE PROCEDURE PMART.REMD_ST_OSTORE_FUNC(P_DAY_ID NUMBER,P_RESPON_ID NUMBER)
SQL SECURITY INVOKER
SP:BEGIN
DECLARE SQLSTR  VARCHAR(8000) DEFAULT ''; 
  CALL PMART.P_DROP_TABLE ('#VT_REMD_ST_OSTORE_FUNC'); 
  CALL PMART.REMD_S1_OSTORE_FUNC(P_DAY_ID,P_RESPON_ID);
  CALL PMART.REMD_S2_OSTORE_FUNC(P_DAY_ID,P_RESPON_ID);
  CALL PMART.REMD_S3_OSTORE_FUNC(P_DAY_ID,P_RESPON_ID);
      SET SQLSTR = 
          'CREATE MULTISET VOLATILE TABLE #VT_REMD_ST_OSTORE_FUNC AS('+ 
          'SELECT '+
          '-1 AS TOT_ID, '+
          'A.ORG_ID AS ORG_ID, '+
          'CAST(A.AMT AS NUMBER) AS AMT, '+
          'A.UPLOAD_STNUM AS UPLOAD_STNUM, '+
          'CAST(A.CUST_NUM AS NUMBER) AS CUST_NUM, '+
          'CAST(A.ACCU_AMT AS NUMBER) AS ACCU_AMT, '+
          'CAST(A.ACCU_PLAN_STNUM AS NUMBER) AS ACCU_PLAN_STNUM, '+
          'CAST(A.ACCU_CUST_NUM AS NUMBER) AS ACCU_CUST_NUM, '+
          'A.BUDGET_ST_AVG_AMT AS BUDGET_ST_AVG_AMT, '+
          'A.BUDGET_ST_TOT_AMT AS BUDGET_ST_TOT_AMT, '+
          'CAST(A.BUDGET_DEPT_AVG_AMT AS NUMBER) AS BUDGET_DEPT_AVG_AMT, '+
          'A.BUDGET_DEPT_TOT_AMT AS BUDGET_DEPT_TOT_AMT, '+
          'A.ACCU_BUDGET AS ACCU_BUDGET, '+
          'A.EX_ACCU_AMT, '+
          'CAST(A.EX_ACCU_PLAN_STNUM AS NUMBER) AS EX_ACCU_PLAN_STNUM, '+                
          'CAST(A.EX_ACCU_CUST_NUM AS NUMBER) AS EX_ACCU_CUST_NUM, '+
          'A.EX_TOT_AMT_LAST_YEAR AS EX_TOT_AMT_LAST_YEAR, '+
          'CAST(A.EX_TOT_PLAN_STNUM_LAST_YEAR AS NUMBER) AS EX_TOT_PLAN_STNUM_LAST_YEAR, '+
          'CAST(A.EX_TOT_CUST_NUM_LAST_YEAR AS NUMBER) AS EX_TOT_CUST_NUM_LAST_YEAR, '+
          'CAST(B.TOT_AMT_LAST_MONTH AS NUMBER) AS TOT_AMT_LAST_MONTH, '+               
          'CAST(B.TOT_PLAN_STNUM_LAST_MONTH AS NUMBER) AS TOT_PLAN_STNUM_LAST_MONTH, '+ 
          '1 AS MAST_STORE_NUM, '+
          'A.TKSL, A.TOT_TKSL, A.ACCU_TKSL, A.EX_TOT_TKSL_LAST_YEAR, '+
          'CAST(B.TOT_TKSL_LAST_MONTH AS NUMBER) AS TOT_TKSL_LAST_MONTH, '+
          'A.EX_ACCU_TKSL, '+
          'A.WEATHER,A.HITEMP,A.LOTEMP,A.SCUST_NUM,A.ACCU_SCUST_NUM, '+
          'CAST(A.EX_ACCU_SCUST_NUM AS NUMBER) AS EX_ACCU_SCUST_NUM, '+
          'CAST(A.EX_TOT_SCUST_NUM_LAST_YEAR AS NUMBER) AS EX_TOT_SCUST_NUM_LAST_YEAR, '+
          'CAST(A.TOT_PLAN_STNUM AS NUMBER) AS TOT_PLAN_STNUM, '+
          'CAST(A.BUDGET_ST_TOT_PLAN_STNUM AS NUMBER) AS BUDGET_ST_TOT_PLAN_STNUM, '+
          'CAST(C.ACCU_CUST_NUM_LAST_YEAR   AS NUMBER) AS ACCU_CUST_NUM_LAST_YEAR, '+
          'CAST(C.ACCU_PLAN_STNUM_LAST_YEAR AS NUMBER) AS ACCU_PLAN_STNUM_LAST_YEAR, '+
          'CAST(C.ACCU_SCUST_NUM_LAST_YEAR  AS NUMBER) AS ACCU_SCUST_NUM_LAST_YEAR '+
          'FROM '+
          '#VT_REMD_S1_OSTORE_FUNC A '+
          ' LEFT JOIN '+
          '#VT_REMD_S2_OSTORE_FUNC B '+
          '   ON (A.ORG_ID=B.ORG_ID) '+
          ' LEFT JOIN '+
          '#VT_REMD_S3_OSTORE_FUNC C '+          
          '   ON (A.ORG_ID=C.ORG_ID) '+         
         ' ) WITH DATA ON COMMIT PRESERVE ROWS;';
    EXECUTE IMMEDIATE SQLSTR; 
END SP;