REPLACE   PROCEDURE PMART.PS_OSTORE
(
)
SP:BEGIN
	DECLARE SQLSTR  VARCHAR(32000);
	DECLARE SQLCREATE  VARCHAR(30000);
	DECLARE MMAWHERE  VARCHAR(20000);
	DECLARE SQLDEL  VARCHAR(20000);
SET SQLDEL =  'DELETE  PTEMP.PS_OSTORE ALL;' ;
EXECUTE IMMEDIATE SQLDEL;   
   SET SQLSTR = ' 
SELECT DISTINCT O.OSTORE_ID  
		FROM PMART.LAST_ORG_DIM O 
		INNER JOIN PMART.LAST_ORG_MMA_DIM MM 
		ON MM.OSTORE_ID = O.OSTORE_ID
		WHERE (
			CASE (SELECT ORG_TYPE FROM  PTEMP.PRDREL_SET )
			WHEN -1 THEN O.TOT_ID
			WHEN 0 THEN O.PDEPT_ID 
			WHEN 2 THEN O.DEPT_ID
			WHEN 2 THEN O.BRANCH_ID
			WHEN 3 THEN O.RESPON_ID
			WHEN 4 THEN O.STORE_ID END 
			) =  (SELECT ORG_ID FROM   PTEMP.PRDREL_SET ) 
'
; 
  SET MMAWHERE =
 '
 	AND	 MM.MMA_ID =  (SELECT MMA_ID FROM PTEMP.PRDREL_SET )
  '
 ;
  IF (SELECT MMA_ID FROM PTEMP.PRDREL_SET) = -1 
 THEN
   SET SQLCREATE = 
   'INSERT INTO  PTEMP.PS_OSTORE '
   +SQLSTR 
   ;
   ELSE
    SET SQLCREATE = 
      'INSERT INTO  PTEMP.PS_OSTORE '
   +SQLSTR + MMAWHERE
   ;
   END IF;
EXECUTE IMMEDIATE SQLCREATE;   
END SP;