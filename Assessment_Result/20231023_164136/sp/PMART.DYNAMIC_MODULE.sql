REPLACE PROCEDURE PMART.DYNAMIC_MODULE
(
	FP_MFACT_TYPE VARCHAR(100),
	FP_STFACT_TYPE VARCHAR(100),
	FP_TIME_LIST VARCHAR(4000),
	FP_ORG_LIST  VARCHAR(4000),
	FP_PRD_LIST  VARCHAR(4000)
)
SQL SECURITY INVOKER
SP:BEGIN
	DECLARE SQLSTR VARCHAR(10000);
	CALL PMART.P_DROP_TABLE ('#VT_DYNAMIC_MODULE');
	CALL PMART.DYNAMIC_MFACT (FP_MFACT_TYPE, FP_TIME_LIST, FP_ORG_LIST, FP_PRD_LIST);
	CALL PMART.DYNAMIC_STFACT (FP_STFACT_TYPE, FP_TIME_LIST, FP_ORG_LIST, FP_PRD_LIST);
	CALL PMART.DYNAMIC_OSTFACT (FP_TIME_LIST, FP_ORG_LIST);
	SET SQLSTR = 'CREATE MULTISET VOLATILE TABLE #VT_DYNAMIC_MODULE  AS( ' 
				+ 'SELECT A.TIME_ID AS TIME_ID, '
				+ 'A.ORG_ID AS ORG_ID, '
				+ 'A.PRD_ID AS PRD_ID, '
				+ 'SALES_CNT, '
				+ 'SALES_AMT, '
				+ 'ORDER_CNT, '
				+ 'ORDER_AMT, '
				+ 'THROW_CNT, '
				+ 'THROW_AMT, '
				+ 'INPRD_CNT, '
				+ 'INPRD_AMT, '
				+ 'RETPRD_CNT, '
				+ 'RETPRD_AMT, '
				+ 'TRANSPRD_CNT, '
				+ 'TRANSPRD_AMT, '
				+ 'DIS_SUB_AMT, '
				+ 'FINAL_SALE_AMT, '
				+ 'SALES_STORE_NUM, '
				+ 'ORDER_STORE_NUM, '
				+ 'THROW_STORE_NUM, '
				+ 'SALES_ORDER_STORE_NUM, '
				+ 'INPRD_STORE_NUM, '
				+ 'RETPRD_STORE_NUM, '
				+ 'TRANSPRD_STORE_NUM, '
				+ 'MAST_STORE_NUM, '
				+ 'PLAN_STORE_NUM '
				+ 'FROM #VT_DYNAMIC_MFACT A, '
				+ '#VT_DYNAMIC_STFACT B, '
				+ '#VT_DYNAMIC_OSTFACT C '
				+ 'WHERE A.TIME_ID = B.TIME_ID  '
				+ 'AND A.ORG_ID = B.ORG_ID  '
				+ 'AND A.PRD_ID = B.PRD_ID '
				+ 'AND A.TIME_ID = C.TIME_ID  '
				+ 'AND A.ORG_ID = C.ORG_ID '
				+ ' ) WITH DATA PRIMARY INDEX (TIME_ID, ORG_ID, PRD_ID) ON COMMIT PRESERVE ROWS;'; 
	EXECUTE IMMEDIATE SQLSTR;  
END SP;