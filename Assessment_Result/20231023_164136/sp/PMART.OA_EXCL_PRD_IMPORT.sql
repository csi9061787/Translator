REPLACE PROCEDURE PMART.OA_EXCL_PRD_IMPORT
(
	IN IMPORT_TYPE INTEGER,
	IN P_EMP_NO VARCHAR(10),
	OUT DATA_CNT INTEGER
)
SQL SECURITY INVOKER
SP:BEGIN
	DECLARE  DATA_TIMESTAMP TIMESTAMP(0);
	SET DATA_TIMESTAMP = CURRENT_TIMESTAMP(0);
	IF IMPORT_TYPE = 1 THEN 
		MERGE INTO PDATA.OA_EXCL_PRD AS Z
		USING PDATA.OA_EXCL_PRD_IF B
		ON Z.TIME_ID = B.TIME_ID AND Z.FM_CODE = B.FM_CODE
		WHEN NOT MATCHED THEN INSERT
		(
		TIME_ID, FM_CODE, EMP_NO, UPDATE_TIME
		)
		VALUES
		(
		B.TIME_ID, B.FM_CODE, P_EMP_NO, DATA_TIMESTAMP
		)
		;
	ELSE IF  IMPORT_TYPE = 2 THEN
		DELETE PDATA.OA_EXCL_PRD WHERE TIME_ID = (SELECT CAST(CAST((CURRENT_DATE (FORMAT 'YYYYMM')) AS VARCHAR(6)) AS INTEGER));
		INSERT INTO PDATA.OA_EXCL_PRD(TIME_ID, FM_CODE, EMP_NO, UPDATE_TIME)
		SELECT TIME_ID, FM_CODE, P_EMP_NO, DATA_TIMESTAMP FROM PDATA.OA_EXCL_PRD_IF;
	END IF;
	END IF;
	SET DATA_CNT = (SELECT COUNT(*) FROM PDATA.OA_EXCL_PRD WHERE UPDATE_TIME = DATA_TIMESTAMP );
END SP;