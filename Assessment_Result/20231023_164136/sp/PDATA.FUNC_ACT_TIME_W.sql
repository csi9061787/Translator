REPLACE PROCEDURE PDATA.FUNC_ACT_TIME_W
(
	IN P_ACT_ID  INTEGER,
	IN P_ACT_TYPE  INTEGER,
	IN P_ACT_SDATE  INTEGER,
	IN P_ACT_EDATE  INTEGER
)
SP:BEGIN
DECLARE SQLSTR  VARCHAR(2000);
DECLARE SQLSTR_ERROR  VARCHAR(2000);
DECLARE P_ERROR_CNT INTEGER;
 DECLARE P_L_DAY_OF_WEEK INTEGER;
DECLARE EXIT HANDLER FOR SQLEXCEPTION
BEGIN		
        SET P_ERROR_CNT = 1;				
		CALL PDATA.P_DROP_TABLE ('#VT_ACT_TIME_W_CHECK');
 		SET SQLSTR_ERROR = ' CREATE MULTISET VOLATILE TABLE #VT_ACT_TIME_W_CHECK AS('
                          +' SELECT 1 AS RETURN_VAL, ''EXECUTE SP:PDATA.FUNC_ACT_TIME_W FAIL'' AS RETURN_DESCR'						  
						  + ' ) WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS; ';		
		EXECUTE IMMEDIATE SQLSTR_ERROR;   
END;
		SET P_ERROR_CNT = 0;
	SELECT L_DAY_OF_WEEK INTO P_L_DAY_OF_WEEK
       FROM PMART.TIME_D 
	 WHERE L_DAY_ID = P_ACT_SDATE;
IF (P_ERROR_CNT = 0) THEN 	
	CALL PMART.FUNC_YMWD_TIME_ACTIVEW(P_ACT_SDATE,P_ACT_EDATE,P_L_DAY_OF_WEEK);
	DELETE FROM PDATA.ACT_TIME_W WHERE ACT_ID = P_ACT_ID AND ACT_TYPE = P_ACT_TYPE;
	INSERT INTO PDATA.ACT_TIME_W
	SELECT P_ACT_ID, P_ACT_TYPE, L_DAY_ID, L_DAY_ID_S, L_DAY_ID_E, L_WEEK_ID, WEKDAY
    FROM #VT_TIME_ACTIVEW;
	CALL PDATA.P_DROP_TABLE ('#VT_ACT_TIME_W_CHECK');
	SET SQLSTR = ' CREATE MULTISET VOLATILE TABLE #VT_ACT_TIME_W_CHECK AS('
    	                      +' SELECT 0 AS RETURN_VAL, ''SUCCESS'' AS RETURN_DESCR'						  							  
							  + ' ) WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS; ';
END IF;
EXECUTE IMMEDIATE SQLSTR;   
END SP;