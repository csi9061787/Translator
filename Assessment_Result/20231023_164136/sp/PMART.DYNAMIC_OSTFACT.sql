REPLACE PROCEDURE PMART.DYNAMIC_OSTFACT
(
	FP_TIME_LIST VARCHAR(4000),
	FP_ORG_LIST  VARCHAR(4000)
)
SQL SECURITY INVOKER
SP:BEGIN
	DECLARE SQLSTR VARCHAR(10000);
	CALL PMART.P_DROP_TABLE ('#VT_DYNAMIC_OSTFACT');
	SET SQLSTR = 'CREATE MULTISET VOLATILE TABLE #VT_DYNAMIC_OSTFACT  AS( ' 
				+ 'SELECT D.TIME_ID AS TIME_ID, '
				+ 'D.ORG_ID AS ORG_ID, '
				+ 'BIT_EXTRACT(BIT_AND(MAST_STORE_NUM,MASK)) AS MAST_STORE_NUM, '
				+ 'BIT_EXTRACT(BIT_AND(PLAN_STORE_NUM,MASK)) AS PLAN_STORE_NUM '
				+ 'FROM ( '
				+ 'SELECT TIME_ID,ORG_ID,MASK '
				+ 'FROM  '
				+ '(' + FP_TIME_LIST + ') T, '
				+ '(SELECT A.ORG_ID AS ORG_ID, A.MASK AS MASK '
				+ 'FROM PMART.LAST_ORG_DIM_MASK A, (' + FP_ORG_LIST + ') B '
				+ 'WHERE A.ORG_ID=B.ORG_ID) M) D, '
				+ 'PMART.BASIC_OST_FACT F '
				+ 'WHERE F.TIME_ID = D.TIME_ID '
				+ ' ) WITH DATA PRIMARY  CHARINDEX( ORG_ID,TIME_ID) ON COMMIT PRESERVE ROWS;'; 
	EXECUTE IMMEDIATE SQLSTR;  
END SP;