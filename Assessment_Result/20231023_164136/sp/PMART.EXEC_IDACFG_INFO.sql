REPLACE PROCEDURE PMART.EXEC_IDACFG_INFO(IN TIME_ID INTEGER)
SQL SECURITY INVOKER
SP:BEGIN
  DECLARE SQLSTR  VARCHAR(4000)  ;
  DECLARE SQL_DEL  VARCHAR(4000) DEFAULT '';
  DECLARE SQL_INSERT  VARCHAR(4000) DEFAULT '';
  DECLARE SQL_EXEC  VARCHAR(20000)  ;
   SELECT TOP 1 SQL_STMT INTO SQLSTR FROM SCV_IDACFGVW.IDA_QRTZ_JOB_LOG WHERE IS_SUCCEED=0 
   AND DatePart(year , JOB_BEGIN_TIME)*10000+DatePart(month , JOB_BEGIN_TIME)*100+DatePart(day , JOB_BEGIN_TIME)*1 = TIME_ID ORDER BY LOG_ID ASC;
   SET SQL_DEL = 'DELETE SCV_IDATMP.TMP_IDACFG_OUT ALL;'; 
   SET SQL_INSERT = 'INSERT INTO SCV_IDATMP.TMP_IDACFG_OUT ';
   SET SQL_EXEC = SQL_INSERT + SQLSTR;
   EXECUTE IMMEDIATE SQL_DEL;
   EXECUTE IMMEDIATE SQL_EXEC;
   SET SQL_DEL = 'DELETE SCV_IDATMP.TMP_IDACFG_INFO ALL;'; 
   SET SQL_INSERT = 'INSERT INTO SCV_IDATMP.TMP_IDACFG_INFO ';
   SET SQLSTR = 'SELECT TOP 1 
							  LOG_ID,
							 (SELECT COUNT(*) FROM SCV_IDATMP.TMP_IDACFG_OUT) AS COUNT_NUM,
							 (SELECT DISTINCT NM FROM SCV_IDATMP.TMP_IDACFG_OUT) AS FILE_NAME,
							 SQL_STMT
							FROM SCV_IDACFGVW.IDA_QRTZ_JOB_LOG
						    WHERE IS_SUCCEED=0
							AND DatePart(year , JOB_BEGIN_TIME)*10000+DatePart(month , JOB_BEGIN_TIME)*100+DatePart(day , JOB_BEGIN_TIME)*1 = '+TIME_ID+ 
							'ORDER BY  LOG_ID ASC;
						';
     SET SQL_EXEC = SQL_INSERT + SQLSTR;
	 EXECUTE IMMEDIATE SQL_DEL;
     EXECUTE IMMEDIATE SQL_EXEC;	 
  END SP;