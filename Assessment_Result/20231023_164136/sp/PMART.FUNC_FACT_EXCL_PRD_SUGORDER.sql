REPLACE PROCEDURE PMART.FUNC_FACT_EXCL_PRD_SUGORDER
(
   IN P_TIMEID VARCHAR(500),
   IN P_ORGID VARCHAR(10)
)
SP:BEGIN
	DECLARE SQLSTR VARCHAR(20000);
	DECLARE SELECT_X VARCHAR(500);
	DECLARE SELECT_Y VARCHAR(500);
	SET SELECT_X = ' ,SUM(T.PRD_QTY) AS TOTPRD_NUM '
						    + ' ,SUM(T.UCPRD_QTY) AS NCHG_CNT '
						    + ' ,CAST(CASE SUM(T.PRD_QTY) WHEN 0 THEN 0 ELSE CAST(SUM(T.UCPRD_QTY) AS DECIMAL(14,4))/CAST(SUM(T.PRD_QTY) AS DECIMAL(14,4))*100 END AS DECIMAL(14,2)) AS PRDUS_RATE '
						    + ' ,SUM(T.STORD_QTY) AS STORD_NUM '
						    + ' ,SUM(T.SYSORD_QTY) AS SYORD_NUM '
						    + ' ,CAST(CASE SUM(T.STORD_QTY) WHEN 0 THEN 0 ELSE CAST(SUM(T.STORD_QTY) AS DECIMAL(14,4))/CAST(SUM(T.SYSORD_QTY) AS DECIMAL(14,4))*100 END AS DECIMAL(14,2)) AS ORDD_RATE ';
	CALL PMART.P_DROP_TABLE ('#VT_FACT_EXCL_PRD_SUGORDER');
	CALL PMART.IGA_6_6_PORG_DIM(2, P_ORGID);
	SET SQLSTR = ' CREATE MULTISET VOLATILE TABLE #VT_FACT_EXCL_PRD_SUGORDER AS( '
						 + ' SELECT T.TIME_ID AS X_DIM '
						 + '       ,D.L_MONTH_NAME AS X_DIM_NM '
						 + '       ,T.ORG_ID AS Y_DIM '
						 + '       ,O.ORG_SNAME AS Y_DIM_NM '
						 + SELECT_X
						 + ' FROM PMART.FACT_PBOA_EXCL_PRD T '
						 + ' INNER JOIN #VT_IGA_6_6_PORG_DIM O ON T.ORG_ID = O.ORG_ID '
						 + ' LEFT JOIN (SELECT DISTINCT L_MONTH_ID, L_MONTH_NAME FROM PMART.YMWD_TIME) D ON T.TIME_ID = D.L_MONTH_ID '
						 + ' WHERE T.TIME_ID IN ('+ P_TIMEID +') '
						 + ' GROUP BY T.TIME_ID, D.L_MONTH_NAME, T.ORG_ID, O.ORG_SNAME '
						 + ' UNION ALL '
						 + ' SELECT CAST(-1 AS INTEGER) AS X_DIM '
						 + '       ,''-1'' AS X_DIM_NM '
						 + '       ,T.ORG_ID AS Y_DIM '
						 + '       ,O.ORG_SNAME AS Y_DIM_NM '
						 + SELECT_X
						 + ' FROM PMART.FACT_PBOA_EXCL_PRD T '
						 + ' INNER JOIN #VT_IGA_6_6_PORG_DIM O ON T.ORG_ID = O.ORG_ID '
						 + ' WHERE T.TIME_ID IN ('+ P_TIMEID +') '
						 + ' GROUP BY T.ORG_ID, O.ORG_SNAME '
						 + ' ) WITH DATA PRIMARY  CHARINDEX(Y_DIM,X_DIM) ON COMMIT PRESERVE ROWS;';
	EXECUTE IMMEDIATE SQLSTR;  
END SP;