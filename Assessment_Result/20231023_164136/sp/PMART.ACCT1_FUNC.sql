REPLACE PROCEDURE PMART.ACCT1_FUNC
(P_YEAR_ID NUMBER,P_ORG_ID NUMBER)
SQL SECURITY INVOKER
SP:BEGIN
DECLARE SQLSTR  VARCHAR(4000) DEFAULT ''; 
  CALL PMART.P_DROP_TABLE ('#VT_ACCT1_FUNC'); 
      SET SQLSTR = 
          'CREATE MULTISET VOLATILE TABLE #VT_ACCT1_FUNC AS('+    
               'SELECT '+
               'A.L_MONTH_ID AS L_MONTH_ID, '+
               'CAST(LOSSCS AS DECIMAL(14,4))/DECODE(SVALUE,0,NULL,SVALUE)*100 AS THROW_RATE, '+
               'CAST(SVALUE AS DECIMAL(14,4))/(DECODE(BGNSL2+ENDSL2,0,NULL,BGNSL2+ENDSL2)/2) AS RETURN_RATE, '+
               'CAST(PROCS AS DECIMAL(16,6))/DECODE(TERMRVN,0,NULL,TERMRVN)*100 AS LOSS_RATE, '+
               'CAST(SALEPROFIT AS DECIMAL(14,4))/DECODE(SVALUE,0,NULL,SVALUE)*100 AS EARN_RATE, '+
               'GAINS-DECODE(GAINS,0,NULL,GAINP) AS EARN_AMT, '+
               'PROCS, '+
               'LOSSCS, '+
               'PRCCHGSL2, '+
               'GAINS, '+
               'GAINP, '+
               'SVALUE '+
               'FROM '+
               '(SELECT DISTINCT L_MONTH_ID FROM PMART.YMWD_TIME WHERE L_YEAR_ID='+P_YEAR_ID+') A '+
               'LEFT JOIN '+
               '(SELECT * FROM PMART.ACCT4420M_SUM WHERE ORG_ID='+P_ORG_ID+') B '+
               'ON (A.L_MONTH_ID=B.L_MONTH_ID) '+
          ') WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;';
    EXECUTE IMMEDIATE SQLSTR; 
END SP;