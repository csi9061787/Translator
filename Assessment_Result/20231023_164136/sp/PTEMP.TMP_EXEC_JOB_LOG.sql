REPLACE PROCEDURE PTEMP.TMP_EXEC_JOB_LOG()
SQL SECURITY INVOKER
SP:BEGIN
  DECLARE SQLSTR  VARCHAR(4000)  ;
  DECLARE SQL_DEL  VARCHAR(4000) DEFAULT '';
  DECLARE SQL_INSERT  VARCHAR(4000) DEFAULT '';
  DECLARE SQL_EXEC  VARCHAR(20000)  ;
   SELECT TOP 1 SQL_STMT INTO SQLSTR FROM SCV_IDACFGVW.IDA_QRTZ_JOB_LOG WHERE IS_SUCCEED=0 ORDER BY JOB_END_TIME DESC;
   SET SQL_DEL = 'DELETE PTEMP.TMP_IDACFG_OUT ALL;'; 
   SET SQL_INSERT = 'INSERT INTO PTEMP.TMP_IDACFG_OUT ';
   SET SQL_EXEC = SQL_INSERT + SQLSTR;
   EXECUTE IMMEDIATE SQL_DEL;
   EXECUTE IMMEDIATE SQL_EXEC;
   SET SQL_DEL = 'DELETE PTEMP.TMP_IDACFG_INFO ALL;'; 
   SET SQL_INSERT = 'INSERT INTO PTEMP.TMP_IDACFG_INFO ';
   SET SQLSTR = 'SELECT TOP 1 
							  LOG_ID,
							 (SELECT COUNT(*) FROM PTEMP.TMP_IDACFG_OUT) AS COUNT_NUM,
							 (SELECT DISTINCT NM FROM PTEMP.TMP_IDACFG_OUT) AS FILE_NAME,
							 SQL_STMT
							FROM SCV_IDACFGVW.IDA_QRTZ_JOB_LOG
						    WHERE IS_SUCCEED=0
                            ORDER BY  JOB_END_TIME DESC;
						';
     SET SQL_EXEC = SQL_INSERT + SQLSTR;
	 EXECUTE IMMEDIATE SQL_DEL;
     EXECUTE IMMEDIATE SQL_EXEC;	 
  END SP;