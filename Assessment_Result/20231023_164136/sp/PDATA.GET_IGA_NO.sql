CREATE  PROCEDURE PDATA.GET_IGA_NO
(
        IN I_NO_TYPE VARCHAR(2), 
		OUT I_NEXT_NUM VARCHAR(10)
)
SP:BEGIN
			DECLARE P_YYYMM  VARCHAR(5)  ; 
			DECLARE P_RETURN  VARCHAR(10);         
			DECLARE P_NEXT_NUM NUMBER(4);
			SET P_YYYMM = TRIM(TO_NUMBER(TO_CHAR(DATE, 'YYYY')) -1911   +  TO_CHAR(DATE, 'MM'));
		     SELECT T.NO_DATE+TO_CHAR(T.NEXT_NUM,'FM0000'), T.NEXT_NUM
			        INTO P_RETURN, P_NEXT_NUM
		         FROM PDATA.IGA_NO T
		      WHERE T.NO_TYPE = I_NO_TYPE
		              AND T.NO_DATE = P_YYYMM;
		IF (P_RETURN IS NULL) THEN 
			INSERT INTO PDATA.IGA_NO (NO_DATE, NO_TYPE, NEXT_NUM, USER_ID, UPDATE_TIME)
                   VALUES (P_YYYMM,I_NO_TYPE,2,'SYSTEM',CURRENT_TIMESTAMP(0) (FORMAT 'YYYYMMDDHHMISS'));
			SET I_NEXT_NUM = TRIM(P_YYYMM+TO_CHAR(1,'FM0000'));  
		ELSE
		     UPDATE PDATA.IGA_NO
		        SET NEXT_NUM = P_NEXT_NUM + 1,
		                   UPDATE_TIME = CURRENT_TIMESTAMP(0) (FORMAT 'YYYYMMDDHHMISS')
		      WHERE NO_TYPE = I_NO_TYPE
		              AND NO_DATE = P_YYYMM;
			SET I_NEXT_NUM = TRIM(P_RETURN);
		END IF;
END SP;