REPLACE PROCEDURE PMART.NEW_PRD_SALES_TCFACT
(FP_TIME_LIST  INTEGER  
,FP_ORG_LEVEL  INTEGER  
,FP_ORG_LIST   INTEGER  
,FP_XAXIS      INTEGER  
,FP_STAS       INTEGER  
)
SQL SECURITY INVOKER
SP:BEGIN
   DECLARE SQLSTR  VARCHAR(64000); 	
   DECLARE V_TABLE_NAME VARCHAR(30);
   DECLARE V_STAS_NAME VARCHAR(30);
   DECLARE V_MEAS_NAME VARCHAR(200);
   DECLARE V_ORG_COLUMN VARCHAR(30);
   DECLARE V_MMA_COLUMN VARCHAR(30);
   CALL PMART.P_DROP_TABLE ('#VT_NEW_PRD_SALES_TCFACT');
   CALL PMART.P_DROP_TABLE ('#VT_ETL_NO');
  SET SQLSTR = 'CREATE MULTISET VOLATILE TABLE #VT_ETL_NO   
                (    
                 XAXIS      INTEGER
                ,XAXIS_NAME VARCHAR(10) Collate Chinese_Taiwan_Stroke_CI_AS
                ) UNIQUE PRIMARY INDEX ( XAXIS ) ON COMMIT PRESERVE ROWS;';   
  EXECUTE IMMEDIATE SQLSTR;           
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (00 , '00:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (01 , '01:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (02 , '02:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (03 , '03:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (04 , '04:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (05 , '05:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (06 , '06:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (07 , '07:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (08 , '08:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (09 , '09:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (10 , '10:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (11 , '11:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (12 , '12:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (13 , '13:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (14 , '14:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (15 , '15:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (16 , '16:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (17 , '17:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (18 , '18:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (19 , '19:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (20 , '20:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (21 , '21:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (22 , '22:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (23 , '23:00~') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (101, '男12以下') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (102, '男12~18 ') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (103, '男19~30 ') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (104, '男31~50 ') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (105, '男50以上') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (201, '女12以下') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (202, '女12~18 ') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (203, '女19~30 ') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (204, '女31~50 ') ;
INSERT INTO #VT_ETL_NO (XAXIS,XAXIS_NAME ) VALUES (205, '女50以上') ;
   SET SQLSTR = 'CREATE MULTISET VOLATILE TABLE #VT_NEW_PRD_SALES_TCFACT  AS('+
      ' SELECT T.L_DAY_ID,T.ORG_ID,T.PRD_ID,X1.XAXIS,X1.XAXIS_NAME '+ 
      ',CAST((CASE X1.XAXIS '+
      '       WHEN 00 THEN SALE_CNT_00 WHEN 01 THEN SALE_CNT_01 '+ 
      '       WHEN 02 THEN SALE_CNT_02 WHEN 03 THEN SALE_CNT_03 '+
      '       WHEN 04 THEN SALE_CNT_04 WHEN 05 THEN SALE_CNT_05 '+ 
      '       WHEN 06 THEN SALE_CNT_06 WHEN 07 THEN SALE_CNT_07 '+
      '       WHEN 08 THEN SALE_CNT_08 WHEN 09 THEN SALE_CNT_09 '+ 
      '       WHEN 10 THEN SALE_CNT_10 WHEN 11 THEN SALE_CNT_11 '+
      '       WHEN 12 THEN SALE_CNT_12 WHEN 13 THEN SALE_CNT_13 '+ 
      '       WHEN 14 THEN SALE_CNT_14 WHEN 15 THEN SALE_CNT_15 '+
      '       WHEN 16 THEN SALE_CNT_16 WHEN 17 THEN SALE_CNT_17 '+ 
      '       WHEN 18 THEN SALE_CNT_18 WHEN 19 THEN SALE_CNT_19 '+
      '       WHEN 20 THEN SALE_CNT_20 WHEN 21 THEN SALE_CNT_21 '+ 
      '       WHEN 22 THEN SALE_CNT_22 WHEN 23 THEN SALE_CNT_23 '+
      '       ELSE NULL END) AS NUMBER ) AS SALE_CNT '+
      ',CAST((CASE X1.XAXIS '+
      '       WHEN 00 THEN SALE_AMT_00 WHEN 01 THEN SALE_AMT_01 '+ 
      '       WHEN 02 THEN SALE_AMT_02 WHEN 03 THEN SALE_AMT_03 '+
      '       WHEN 04 THEN SALE_AMT_04 WHEN 05 THEN SALE_AMT_05 '+ 
      '       WHEN 06 THEN SALE_AMT_06 WHEN 07 THEN SALE_AMT_07 '+
      '       WHEN 08 THEN SALE_AMT_08 WHEN 09 THEN SALE_AMT_09 '+ 
      '       WHEN 10 THEN SALE_AMT_10 WHEN 11 THEN SALE_AMT_11 '+
      '       WHEN 12 THEN SALE_AMT_12 WHEN 13 THEN SALE_AMT_13 '+ 
      '       WHEN 14 THEN SALE_AMT_14 WHEN 15 THEN SALE_AMT_15 '+
      '       WHEN 16 THEN SALE_AMT_16 WHEN 17 THEN SALE_AMT_17 '+ 
      '       WHEN 18 THEN SALE_AMT_18 WHEN 19 THEN SALE_AMT_19 '+
      '       WHEN 20 THEN SALE_AMT_20 WHEN 21 THEN SALE_AMT_21 '+ 
      '       WHEN 22 THEN SALE_AMT_22 WHEN 23 THEN SALE_AMT_23 '+
      '       ELSE NULL END) AS NUMBER ) AS SALE_AMT '+
      ',CAST((CASE X1.XAXIS '+
      '       WHEN 00 THEN SALE_DIS_00 WHEN 01 THEN SALE_DIS_01 '+ 
      '       WHEN 02 THEN SALE_DIS_02 WHEN 03 THEN SALE_DIS_03 '+
      '       WHEN 04 THEN SALE_DIS_04 WHEN 05 THEN SALE_DIS_05 '+ 
      '       WHEN 06 THEN SALE_DIS_06 WHEN 07 THEN SALE_DIS_07 '+
      '       WHEN 08 THEN SALE_DIS_08 WHEN 09 THEN SALE_DIS_09 '+ 
      '       WHEN 10 THEN SALE_DIS_10 WHEN 11 THEN SALE_DIS_11 '+
      '       WHEN 12 THEN SALE_DIS_12 WHEN 13 THEN SALE_DIS_13 '+ 
      '       WHEN 14 THEN SALE_DIS_14 WHEN 15 THEN SALE_DIS_15 '+
      '       WHEN 16 THEN SALE_DIS_16 WHEN 17 THEN SALE_DIS_17 '+ 
      '       WHEN 18 THEN SALE_DIS_18 WHEN 19 THEN SALE_DIS_19 '+
      '       WHEN 20 THEN SALE_DIS_20 WHEN 21 THEN SALE_DIS_21 '+ 
      '       WHEN 22 THEN SALE_DIS_22 WHEN 23 THEN SALE_DIS_23 '+
      '       ELSE NULL END) AS NUMBER ) AS SALE_DIS '+
      ',CAST((CASE X1.XAXIS '+
      '       WHEN 00 THEN SALE_SUB_00 WHEN 01 THEN SALE_SUB_01 '+ 
      '       WHEN 02 THEN SALE_SUB_02 WHEN 03 THEN SALE_SUB_03 '+
      '       WHEN 04 THEN SALE_SUB_04 WHEN 05 THEN SALE_SUB_05 '+ 
      '       WHEN 06 THEN SALE_SUB_06 WHEN 07 THEN SALE_SUB_07 '+
      '       WHEN 08 THEN SALE_SUB_08 WHEN 09 THEN SALE_SUB_09 '+ 
      '       WHEN 10 THEN SALE_SUB_10 WHEN 11 THEN SALE_SUB_11 '+
      '       WHEN 12 THEN SALE_SUB_12 WHEN 13 THEN SALE_SUB_13 '+ 
      '       WHEN 14 THEN SALE_SUB_14 WHEN 15 THEN SALE_SUB_15 '+
      '       WHEN 16 THEN SALE_SUB_16 WHEN 17 THEN SALE_SUB_17 '+ 
      '       WHEN 18 THEN SALE_SUB_18 WHEN 19 THEN SALE_SUB_19 '+
      '       WHEN 20 THEN SALE_SUB_20 WHEN 21 THEN SALE_SUB_21 '+ 
      '       WHEN 22 THEN SALE_SUB_22 WHEN 23 THEN SALE_SUB_23 '+
      '       ELSE NULL END) AS NUMBER ) AS SALE_SUB '+
      ',CAST((CASE X1.XAXIS '+
      '       WHEN 101 THEN SALE_CNT_M12 WHEN 102 THEN SALE_CNT_M18 '+ 
      '       WHEN 103 THEN SALE_CNT_M30 WHEN 104 THEN SALE_CNT_M50 '+ 
      '       WHEN 105 THEN SALE_CNT_MO  WHEN 201 THEN SALE_CNT_F12 '+ 
      '       WHEN 202 THEN SALE_CNT_F18 WHEN 203 THEN SALE_CNT_F30 '+ 
      '       WHEN 204 THEN SALE_CNT_F50 WHEN 205 THEN SALE_CNT_FO  '+
      '       ELSE NULL END) AS NUMBER ) AS SALE_CNT_MF '+
      ',CAST((CASE X1.XAXIS  '+
      '       WHEN 101 THEN SALE_AMT_M12 WHEN 102 THEN SALE_AMT_M18 '+ 
      '       WHEN 103 THEN SALE_AMT_M30 WHEN 104 THEN SALE_AMT_M50 '+ 
      '       WHEN 105 THEN SALE_AMT_MO  WHEN 201 THEN SALE_AMT_F12 '+ 
      '       WHEN 202 THEN SALE_AMT_F18 WHEN 203 THEN SALE_AMT_F30 '+ 
      '       WHEN 204 THEN SALE_AMT_F50 WHEN 205 THEN SALE_AMT_FO  '+
      '       ELSE NULL END) AS NUMBER ) AS SALE_AMT_MF '+
      ',CAST( (SALE_CNT_00 + SALE_CNT_01 + SALE_CNT_02 + SALE_CNT_03 + SALE_CNT_04 '+
      '      + SALE_CNT_05 + SALE_CNT_06 + SALE_CNT_07 + SALE_CNT_08 + SALE_CNT_09 '+
      '      + SALE_CNT_10 + SALE_CNT_11 + SALE_CNT_12 + SALE_CNT_13 + SALE_CNT_14 '+
      '      + SALE_CNT_15 + SALE_CNT_16 + SALE_CNT_17 + SALE_CNT_18 + SALE_CNT_19 '+
      '      + SALE_CNT_20 + SALE_CNT_21 + SALE_CNT_22 + SALE_CNT_23) AS NUMBER) AS TOT_SALE_CNT  '+
      ',CAST( (SALE_AMT_00 + SALE_AMT_01 + SALE_AMT_02 + SALE_AMT_03 + SALE_AMT_04 '+
      '      + SALE_AMT_05 + SALE_AMT_06 + SALE_AMT_07 + SALE_AMT_08 + SALE_AMT_09 '+
      '      + SALE_AMT_10 + SALE_AMT_11 + SALE_AMT_12 + SALE_AMT_13 + SALE_AMT_14 '+
      '      + SALE_AMT_15 + SALE_AMT_16 + SALE_AMT_17 + SALE_AMT_18 + SALE_AMT_19 '+
      '      + SALE_AMT_20 + SALE_AMT_21 + SALE_AMT_22 + SALE_AMT_23) AS NUMBER) AS TOT_SALE_AMT  '+
      '   FROM PMART.NEW_TCFACT_SUM T, #VT_ETL_NO X1'+ 
      ' WHERE T.L_DAY_ID = '+FP_TIME_LIST+' '+   
      '   AND T.ORG_ID   = '+FP_ORG_LIST+' '+        
      ') WITH DATA UNIQUE PRIMARY INDEX ( L_DAY_ID,PRD_ID,XAXIS_NAME ) ON COMMIT PRESERVE ROWS;'; 
	EXECUTE IMMEDIATE SQLSTR;
END SP;