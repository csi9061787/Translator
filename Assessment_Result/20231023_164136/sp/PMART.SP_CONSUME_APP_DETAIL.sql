REPLACE  PROCEDURE PMART.SP_CONSUME_APP_DETAIL(V_BATCH_NO VARCHAR(20))
SP:BEGIN
	DECLARE V_MAX_ID INTEGER;
	DECLARE P_BATCH_NO VARCHAR(20);
	SET V_MAX_ID = (SELECT CAST(NVL(MAX(ID),'0') AS INTEGER) FROM PMART.CONSUME_APP_DETAIL );
    SET P_BATCH_NO=V_BATCH_NO;
	DELETE FROM PMART.CONSUME_APP_DETAIL
    WHERE BATCH_NO=P_BATCH_NO;
	INSERT INTO PMART.CONSUME_APP_DETAIL
    (ID, F_ID, F_ORDER, F_GROUP_ID, UNIT_PRICE, QUANTITY, PRD_
	SELECT   CAST(ROW_NUMBER() OVER (ORDER BY A.TM_TXNNO  DESC) AS INTEGER)+V_MAX_ID,
	 A.STORE_NO+A.TM_NO+CAST((A.PAY_AT (FORMAT 'YYYYMMDDHHMISS')) AS VARCHAR(50))+A.TM_TXNNO AS F_ID,
	B.F_ORDER,SUBSTRING(B.PRD_ID,1,3) AS F_GROUP_ID,
	CAST((CASE WHEN A.IS_RETURN='Z0' THEN B.SL_UNT ELSE  B.SL_UNT*-1 END)AS VARCHAR(10))  AS SL_UNT
	,CAST((CASE WHEN A.IS_RETURN='Z0' THEN B.QUANTITY ELSE  B.QUANTITY*-1 END)AS VARCHAR(5))  AS QUANTITY
	,(SELECT FM_NAME FROM PDATA.PBMCMDT WHERE FM_CODE=B.PRD_ID) AS PRD_NM,V_BATCH_NO,CURRENT_TIMESTAMP(0)
	FROM PDATA.TRANS_APP AS   A
	JOIN PDATA.TRANS_DETAIL_APP AS B ON A.TM_TXNNO=B.TM_TXNNO
	WHERE A.BATCH_NO=CAST(P_BATCH_NO AS TIMESTAMP FORMAT 'YYYYMMDDHHMISS');
END;