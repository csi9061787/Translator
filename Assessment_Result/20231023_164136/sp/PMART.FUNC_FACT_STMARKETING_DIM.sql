REPLACE PROCEDURE PMART.FUNC_FACT_STMARKETING_DIM
(
   IN P_ACTID INTEGER
)
SP:BEGIN
    DECLARE SQLSTR  VARCHAR(2000) ;
    CALL PMART.P_DROP_TABLE ('#VT_FUNC_FACT_STMARKETING_DIM');
    SET SQLSTR = 'CREATE MULTISET VOLATILE TABLE #VT_FUNC_FACT_STMARKETING_DIM ( '
	                     +'RAISE_ID INTEGER, '
						 +'ITEM_ID INTEGER, '
						 +'ITEM_COL VARCHAR(40), '
	                     +'ITEM_NAME VARCHAR(40)   '
	                     +') UNIQUE PRIMARY INDEX(ITEM_ID) ON COMMIT PRESERVE ROWS; ';
    EXECUTE IMMEDIATE SQLSTR;   
	SET SQLSTR = 'INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM SELECT 0,1000001,''SALE_AMT'',CAST('' ' +'銷售金額_排菸' +' ''  AS VARCHAR(40)); ';
	EXECUTE IMMEDIATE SQLSTR;
   SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM SELECT 0,1000002,''CIG_AMT'',CAST('' ' +'香菸銷售金額' +' ''  AS VARCHAR(40)); ';
	EXECUTE IMMEDIATE SQLSTR;
    SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM SELECT 0,1000003,''DIS_SUB_AMT'',CAST('' ' +'折扣讓金額' +' ''  AS VARCHAR(40)); ';
	EXECUTE IMMEDIATE SQLSTR;
    SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM SELECT 0,1000004,''TRAN_CNT'',CAST('' ' +'客數' +' ''  AS VARCHAR(40)); ';
	EXECUTE IMMEDIATE SQLSTR;
    SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM SELECT 0,1000005,''DAISO_AMT'',CAST('' ' +'代售金額' +' ''  AS VARCHAR(40)); ';
	EXECUTE IMMEDIATE SQLSTR;
    SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM SELECT 0,1000006,''DAIFU_AMT'',CAST('' ' +'代付金額' +' ''  AS VARCHAR(40)); ';
	EXECUTE IMMEDIATE SQLSTR;
    SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM SELECT 0,1000007,''MARKETING_TRAN_CNT'',CAST('' ' +'應發筆數' +' ''  AS VARCHAR(40)); ';
	EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM SELECT 0,1000008,''MARKETING_TOT_POINT'',CAST('' ' +'應發點數' +' ''  AS VARCHAR(40)); ';      
	EXECUTE IMMEDIATE SQLSTR;
    SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM SELECT 0,1000009,''MARKETING_POINT'',CAST('' ' +'滿額實發點數' +' ''  AS VARCHAR(40)); ';
	EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM SELECT 0,1000010,''MARKETING_CAL_POINT'',CAST('' ' +'總實發點數' +' ''  AS VARCHAR(40)); ';      
	EXECUTE IMMEDIATE SQLSTR;	
	SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM SELECT 0,1000011,''MARKETING_NOTRAN_POINT'',CAST('' ' +'應發未發點數' +' ''  AS VARCHAR(40)); ';      
	EXECUTE IMMEDIATE SQLSTR;	
    SET SQLSTR = ' INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM SELECT 0,1000012,''MARKETING_POMO_POINT'',CAST('' ' +'加碼送_實發點數' +' ''  AS VARCHAR(40)); ';
	EXECUTE IMMEDIATE SQLSTR;
	SET SQLSTR = 'INSERT INTO #VT_FUNC_FACT_STMARKETING_DIM '
	                     +'SELECT RAISE_ID,2 + TRIM(SUBSTRING('''+ CAST('000000' AS VARCHAR(6)) +''',1,6-LENGTH(TRIM(TO_CHAR(RAISE_ID)))))  +  TRIM(TO_CHAR(RAISE_ID)) ITEM_ID,'''' ITEM_COL,RAISE_NM ITEM_NAME '
	    	             +'   FROM PDATA.STORMKT_RAISE_M '
	                     +'WHERE ACT_ID = ' + P_ACTID + '; ';
    EXECUTE IMMEDIATE SQLSTR;   
END SP;