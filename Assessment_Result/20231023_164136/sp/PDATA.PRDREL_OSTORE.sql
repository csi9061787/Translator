REPLACE   PROCEDURE PDATA.PRDREL_OSTORE
(
)
SP:BEGIN
	DECLARE SQLSTR  VARCHAR(32000);
SET SQLSTR =  'DELETE  PTEMP.PS_OSTORE ALL;' ;
EXECUTE IMMEDIATE SQLSTR;   
SET SQLSTR = ' 
INSERT INTO  PTEMP.PS_OSTORE 
SELECT DISTINCT O.OSTORE_ID  
		FROM PMART.LAST_ORG_DIM O 
		INNER JOIN PMART.LAST_ORG_MMA_DIM MM 
		ON MM.OSTORE_ID = O.OSTORE_ID
		WHERE (
			CASE (SELECT ORG_TYPE FROM  PTEMP.PRDREL_SET )
			WHEN -1 THEN O.TOT_ID
			WHEN 0 THEN O.PDEPT_ID 
			WHEN 1 THEN O.DEPT_ID
			WHEN 2 THEN O.BRANCH_ID
			WHEN 3 THEN O.RESPON_ID
			WHEN 4 THEN O.OSTORE_ID END 
			) =  (SELECT ORG_ID FROM   PTEMP.PRDREL_SET ) 
'; 
IF (SELECT MMA_ID FROM PTEMP.PRDREL_SET) <> -1  THEN
	SET SQLSTR = SQLSTR + ' AND MM.MMA_ID =  (SELECT MMA_ID FROM PTEMP.PRDREL_SET ) ';
END IF; 
IF (SELECT COUNT(0) FROM PDATA.PRDREL_STOR_SET WHERE JOB_ID=(SELECT JOB_ID FROM PTEMP.PRDREL_SET)) > 0   THEN
	SET SQLSTR = SQLSTR + ' AND O.OSTORE_ID IN (SELECT ORG_ID FROM PDATA.PRDREL_STOR_SET WHERE JOB_ID=(SELECT JOB_ID FROM PTEMP.PRDREL_SET))';
END IF; 
EXECUTE IMMEDIATE SQLSTR;   
END SP;