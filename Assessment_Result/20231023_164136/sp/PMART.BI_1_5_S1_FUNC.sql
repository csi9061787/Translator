REPLACE PROCEDURE PMART.BI_1_5_S1_FUNC(P_DAY_ID VARCHAR(2000),
									 P_ORG_ID VARCHAR(2000),
									 P_PRD_LIST VARCHAR(2000))
SQL SECURITY INVOKER
SP:BEGIN
   DECLARE SQLSTR VARCHAR(64000);
   DECLARE V_SQL VARCHAR(20000);
   DECLARE V_STRING VARCHAR(20000);
   DECLARE V_PRD_LIST VARCHAR(2000);
   SET V_PRD_LIST = PMART.CONVERT_STRING_LIST(P_PRD_LIST);
   CALL PMART.P_DROP_TABLE ('#VT_BI_1_5_S1_FUNC'); 
   SET V_STRING = 'SELECT TIME_ID,PRD_ID,SALES_CNT,ORDER_CNT FROM PMART.BASIC_MLFACT_ORD1 '+
    'WHERE TIME_ID IN ( '+
    'SELECT B.L_DAY_ID '+
    'FROM PMART.YMWD_TIME A, PMART.YMWD_TIME B '+
    'WHERE A.L_DAY_ID='+ P_DAY_ID + ' ' +
    'AND B.L_DAY_SERIAL BETWEEN A.L_DAY_SERIAL-6 AND A.L_DAY_SERIAL '+
    ') '+
    'AND ORG_ID='+ P_ORG_ID + ' ' +
    'AND PRD_ID IN ('+ V_PRD_LIST +') '+
    'UNION '+
    'SELECT TIME_ID,PRD_ID,SALES_CNT,ORDER_CNT FROM PMART.BASIC_MFACT_ORD1 '+
    'WHERE TIME_ID IN ( '+
    'SELECT B.L_DAY_ID '+
    'FROM PMART.YMWD_TIME A, PMART.YMWD_TIME B '+
    'WHERE A.L_DAY_ID='+ P_DAY_ID + ' ' +
    'AND B.L_DAY_SERIAL BETWEEN A.L_DAY_SERIAL-6 AND A.L_DAY_SERIAL '+
    ') '+
    'AND ORG_ID='+ P_ORG_ID + ' ' +
    'AND PRD_ID IN ('+ V_PRD_LIST +') '+
    'UNION '+
    'SELECT TIME_ID,PRD_ID,SALES_CNT,ORDER_CNT FROM PMART.BASIC_MFACT_DETAIL_ORD1 '+
    'WHERE TIME_ID IN ( '+
    'SELECT B.L_DAY_ID '+
    'FROM PMART.YMWD_TIME A, PMART.YMWD_TIME B '+
    'WHERE A.L_DAY_ID='+P_DAY_ID + ' ' +
    'AND B.L_DAY_SERIAL BETWEEN A.L_DAY_SERIAL-6 AND A.L_DAY_SERIAL '+
    ') '+
    'AND ORG_ID='+ P_ORG_ID + ' ' +
    'AND PRD_ID IN ('+ V_PRD_LIST +') ';
   SET SQLSTR ='CREATE MULTISET VOLATILE TABLE #VT_BI_1_5_S1_FUNC  AS('+
        V_STRING +
   ') WITH DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;'; 
	EXECUTE IMMEDIATE SQLSTR;
END SP;