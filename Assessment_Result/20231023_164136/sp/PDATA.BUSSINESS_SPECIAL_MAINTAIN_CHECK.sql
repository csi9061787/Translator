REPLACE PROCEDURE PDATA.BUSSINESS_SPECIAL_MAINTAIN_CHECK
(
OUT DATA_CNT INTEGER,
OUT ERR_CNT INTEGER
)
SQL SECURITY INVOKER
SP:BEGIN
 CALL PMART.P_DROP_TABLE ('#TMP_BUSSINESS_SPECIAL_MAINTAIN');
 CREATE MULTISET VOLATILE  TABLE #TMP_BUSSINESS_SPECIAL_MAINTAIN AS 
(
SELECT OSTORE_NO,OSTORE_NO_TYPE,'原始店號不存在主檔中' AS ERR_MSG FROM PSTAGE.BUSSINESS_SPECIAL_MAINTAIN_IF
WHERE OSTORE_NO NOT IN (SELECT DISTINCT OSTORE_NO  FROM PDATA.PBMSTOR)
)
WITH  DATA NO PRIMARY INDEX ON COMMIT PRESERVE ROWS;
UPDATE PSTAGE.BUSSINESS_SPECIAL_MAINTAIN_IF
FROM  #TMP_BUSSINESS_SPECIAL_MAINTAIN B
SET ERR_MSG = NVL(BUSSINESS_SPECIAL_MAINTAIN_IF.ERR_MSG,'')+','+ B.ERR_MSG
WHERE BUSSINESS_SPECIAL_MAINTAIN_IF.OSTORE_NO = B.OSTORE_NO
;
 CALL PMART.P_DROP_TABLE ('#TMP_BUSSINESS_SPECIAL_MAINTAIN');
 SET DATA_CNT = (SELECT COUNT(*) FROM PSTAGE.BUSSINESS_SPECIAL_MAINTAIN_IF);
 SET ERR_CNT = (SELECT COUNT(*) FROM PSTAGE.BUSSINESS_SPECIAL_MAINTAIN_IF WHERE LENGTH(ERR_MSG)>0);
END SP;