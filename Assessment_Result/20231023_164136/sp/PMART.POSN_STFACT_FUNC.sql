REPLACE PROCEDURE PMART.POSN_STFACT_FUNC(
FP_TIME_TYPE CHAR, 
FP_TIME_LIST VARCHAR(400), 
FP_PRD_LEVEL VARCHAR(400), 
FP_PRD_ID    VARCHAR(1000), 
FP_PRD_SQL   NUMBER, 
FP_ORG_LEVEL NUMBER, 
FP_ORG_LIST  VARCHAR(400), 
FP_MMA_LEVEL NUMBER, 
FP_MMA_ID    VARCHAR(400), 
FP_PRD_TYPE  NUMBER 
)
SQL SECURITY INVOKER
SP:BEGIN
   DECLARE V_TABLE_NAME2 VARCHAR(400); 
   DECLARE V_MMA VARCHAR(400); 
   DECLARE V_MMA_AND VARCHAR(400); 
   DECLARE SQLSTR    VARCHAR(4000);
   CALL PMART.P_DROP_TABLE ('#VT_POSN_STFACT_FUNC'); 
   CALL PMART.POSN_STFACT_1_FUNC(FP_TIME_TYPE,FP_TIME_LIST,FP_PRD_LEVEL,FP_PRD_ID,FP_PRD_SQL,FP_ORG_LEVEL,FP_ORG_LIST,FP_MMA_LEVEL,FP_MMA_ID,FP_PRD_TYPE);
   SET V_MMA = '0 AS MMA_ID, ';
   SET V_MMA_AND = ' ';
   IF (FP_MMA_LEVEL = 0 OR FP_MMA_LEVEL = 1) THEN 
      SET V_MMA ='B.MMA_ID AS MMA_ID, ';
      SET V_MMA_AND =' AND A.MMA_ID = B.MMA_ID ';
      SET V_TABLE_NAME2 ='PMART.BASIC_MAST_FACT_SHOP ';
   ELSE 
      SET  V_TABLE_NAME2 ='PMART.BASIC_MAST_FACT ';
   END IF;
   SET SQLSTR ='CREATE MULTISET VOLATILE TABLE #VT_POSN_STFACT_FUNC  AS('+
      'SELECT    '+
      'B.TIME_ID AS TIME_ID,    '+
      'Y.ORG_ID AS ORG_ID,    '+
      'B.PRD_ID AS PRD_ID,   '+
      ' '+V_MMA+' '+
      '0 AS MAST_STORE_NUM,   '+ 
      '0 AS STNUM_STORE_NUM,  '+ 
      'BIT_EXTRACT(BIT_AND(B.SALES_STORE_NUM,Y.MASK)) AS SALES_STORE_NUM,  '+ 
      'BIT_EXTRACT(BIT_AND(B.ORDER_STORE_NUM,Y.MASK)) AS ORDER_STORE_NUM,  '+ 
      'BIT_EXTRACT(BIT_AND(B.THROW_STORE_NUM,Y.MASK)) AS THROW_STORE_NUM,  '+ 
      'BIT_EXTRACT(BIT_AND(B.INPRD_STORE_NUM,Y.MASK)) AS INPRD_STORE_NUM,  '+ 
      'BIT_EXTRACT(BIT_AND(B.RETPRD_STORE_NUM,Y.MASK)) AS RETPRD_STORE_NUM,  '+ 
      'BIT_EXTRACT(BIT_AND(B.TRANSPRD_STORE_NUM,Y.MASK)) AS TRANSPRD_STORE_NUM,  '+ 
      'BIT_EXTRACT(BIT_AND(B.TRANSPRD_IN_STORE_NUM,Y.MASK)) AS TRANSPRD_IN_STORE_NUM,  '+ 
      'BIT_EXTRACT(BIT_AND(B.Y_ORDER_STORE_NUM,Y.MASK)) AS Y_ORDER_STORE_NUM, '+ 
      'BIT_EXTRACT(BIT_AND(B.SALES_STORE_NUM,Y.MASK)) AS SALES_STNUM,  '+ 
      'BIT_EXTRACT(BIT_AND(B.ORDER_STORE_NUM,Y.MASK)) AS ORDER_STNUM,  '+ 
      'BIT_EXTRACT(BIT_AND(B.THROW_STORE_NUM,Y.MASK)) AS THROW_STNUM,  '+ 
      'BIT_EXTRACT(BIT_AND(B.INPRD_STORE_NUM,Y.MASK)) AS INPRD_STNUM,  '+ 
      'BIT_EXTRACT(BIT_AND(B.RETPRD_STORE_NUM,Y.MASK)) AS RETPRD_STNUM,  '+ 
      'BIT_EXTRACT(BIT_AND(B.TRANSPRD_STORE_NUM,Y.MASK)) AS TRANSPRD_STNUM,  '+ 
      'BIT_EXTRACT(BIT_AND(B.TRANSPRD_IN_STORE_NUM,Y.MASK)) AS TRANSPRD_IN_STNUM,  '+ 
      'BIT_EXTRACT(BIT_AND(B.Y_ORDER_STORE_NUM,Y.MASK)) AS Y_ORDER_STNUM  '+ 
      ' FROM'+
      '( '+
      'SELECT '+
      'B.TIME_ID AS TIME_ID,  '+
      'B.PRD_ID AS PRD_ID,  '+
      ' '+V_MMA+' '+
      'B.SALES_STORE_NUM AS SALES_STORE_NUM,  '+
      'B.ORDER_STORE_NUM AS ORDER_STORE_NUM,  '+
      'B.THROW_STORE_NUM AS THROW_STORE_NUM,  '+
      'B.INPRD_STORE_NUM AS INPRD_STORE_NUM,  '+
      'B.RETPRD_STORE_NUM AS RETPRD_STORE_NUM,  '+
      'B.TRANSPRD_STORE_NUM AS TRANSPRD_STORE_NUM,  '+
      'B.TRANSPRD_IN_STORE_NUM AS TRANSPRD_IN_STORE_NUM,  '+
      'B.Y_ORDER_STORE_NUM AS Y_ORDER_STORE_NUM,   '+
      'BIT_EXTRACT(BIT_AND(B.SALES_STORE_NUM,A.STNUM_STORE_NUM)) AS SALES_STNUM,  '+
      'BIT_EXTRACT(BIT_AND(B.ORDER_STORE_NUM,A.STNUM_STORE_NUM)) AS ORDER_STNUM,  '+
      'BIT_EXTRACT(BIT_AND(B.THROW_STORE_NUM,A.STNUM_STORE_NUM)) AS THROW_STNUM,  '+
      'BIT_EXTRACT(BIT_AND(B.INPRD_STORE_NUM,A.STNUM_STORE_NUM)) AS INPRD_STNUM,  '+
      'BIT_EXTRACT(BIT_AND(B.RETPRD_STORE_NUM,A.STNUM_STORE_NUM)) AS RETPRD_STNUM,  '+
      'BIT_EXTRACT(BIT_AND(B.TRANSPRD_STORE_NUM,A.STNUM_STORE_NUM)) AS TRANSPRD_STNUM,  '+
      'BIT_EXTRACT(BIT_AND(B.TRANSPRD_IN_STORE_NUM,A.STNUM_STORE_NUM)) AS TRANSPRD_IN_STNUM,  '+
      'BIT_EXTRACT(BIT_AND(B.Y_ORDER_STORE_NUM,A.STNUM_STORE_NUM)) AS Y_ORDER_STNUM  '+
      ' FROM  '+
      ' #VT_POSN_STFACT_1_FUNC B  '+
      ', '+ V_TABLE_NAME2 +' A '+
      ' WHERE A.TIME_ID = B.TIME_ID '+ V_MMA_AND +' '+
      ') B, '+
      ' PMART.LAST_ORG_DIM_MASK Y   '+
      ' WHERE Y.ORG_ID IN ( '+ FP_ORG_LIST +' )'+
     ') WITH DATA  PRIMARY INDEX ( PRD_ID, TIME_ID,ORG_ID) ON COMMIT PRESERVE ROWS ;';
  DELETE FROM PMART.T1 WHERE F1 = 9;
  INSERT INTO PMART.T1(F1,F2) SELECT 9,SQLSTR;		
  EXECUTE IMMEDIATE SQLSTR;
END SP;